--============================
-- BURSA REFERENCE TABLES
--============================

-- The reason to create these tables is to have integer column to query the stocks in demography tables
-- querying with stock code which is a string is not as efficient

--==================
-- REF_BURSA_STOCK
--==================

--drop table dibots_v2.ref_bursa_stock;
create table dibots_v2.ref_bursa_stock (
id int generated by default as identity primary key,
stock_code text,
created_dtime timestamptz,
created_by text
);
create unique index ref_bursa_stock_uniq on dibots_v2.ref_bursa_stock (stock_code);

select * from dibots_v2.ref_bursa_stock;

select distinct stock_code from dibots_v2.exchange_daily_transaction order by stock_code asc;

insert into dibots_v2.ref_bursa_stock (stock_code, created_dtime, created_by)
select distinct(stock_code), now(), 'kangwei'  from dibots_v2.exchange_daily_transaction order by stock_code asc;

--===================
-- REF_BURSA_BOARD
--===================

drop table dibots_v2.ref_bursa_board;
create table dibots_v2.ref_bursa_board (
id int generated by default as identity primary key,
board text,
created_dtime timestamptz,
created_by text
);
create unique index ref_bursa_board_uniq on dibots_v2.ref_bursa_board (board);

select * from dibots_v2.ref_bursa_board

insert into dibots_v2.ref_bursa_board (board, created_dtime, created_by)
select distinct(board), now(), 'kangwei' from dibots_v2.exchange_daily_transaction order by board asc;

--====================
-- REF_BURSA_SECTOR
--====================

--drop table dibots_v2.ref_bursa_sector;
create table dibots_v2.ref_bursa_sector (
id int generated by default as identity primary key,
sector text,
created_dtime timestamptz,
created_by text
);
create unique index ref_bursa_sector_uniq on dibots_v2.ref_bursa_sector (sector);

select * from dibots_v2.ref_bursa_sector;

insert into dibots_v2.ref_bursa_sector(sector, created_dtime, created_by)
select distinct(sector), now(), 'kangwei' from dibots_v2.exchange_daily_transaction order by sector asc;

--========================
-- REF_BURSA_SEC_TYPE
--========================

create table dibots_v2.ref_bursa_sec_type (
id int generated by default as identity primary key,
security_type text,
created_dtime timestamptz,
created_by text
);
create unique index ref_bursa_sec_type_uniq on dibots_v2.ref_bursa_sec_type (security_type);

select * from dibots_v2.ref_bursa_sec_type;

insert into dibots_v2.ref_bursa_sec_type (security_type, created_dtime, created_by)
select distinct(security_type), now(), 'kangwei' from dibots_v2.exchange_daily_transaction order by security_type asc;

--=======================
-- REF_DEMOGRAPHY_STOCK
--=======================

CREATE TABLE dibots_v2.ref_demography_stock (
trading_date date,
stock_code text,
stock_num int,
stock_name text,
board text,
board_num int,
sector text,
sector_num int,
security_type text,
sec_type_num int,
klci_flag bool default false,
fbm100_flag bool default false,
shariah_flag bool default false,
esg_flag bool default false,
esg_rating int,
f4gbm_flag bool default false
);
alter table dibots_v2.ref_demography_stock add constraint ref_demog_stock_pkey primary key (trading_date, stock_num);
create index ref_demog_stock_combo_idx on dibots_v2.ref_demography_stock (trading_date, board_num, sector_num);

-- FRESH INSERTION
insert into dibots_v2.ref_demography_stock (trading_date, stock_code, stock_num, stock_name, board, board_num, sector, sector_num, security_type, sec_type_num, 
klci_flag, fbm100_flag, shariah_flag, esg_flag, esg_rating, f4gbm_flag)
select transaction_date, stock_code, stock_num, stock_name_short, board, board_num, sector, sector_num, security_type, sec_type_num, klci_flag, fbm100_flag, shariah_flag,
esg_flag, esg_rating, f4gbm_flag from dibots_v2.exchange_daily_transaction
order by transaction_date asc, stock_code asc;

-- INCREMENTAL
insert into dibots_v2.ref_demography_stock (trading_date, stock_code, stock_num, stock_name, board, board_num, sector, sector_num, security_type, sec_type_num, 
klci_flag, fbm100_flag, shariah_flag, esg_flag, esg_rating, f4gbm_flag)
select transaction_date, stock_code, stock_num, stock_name_short, board, board_num, sector, sector_num, security_type, sec_type_num, klci_flag, fbm100_flag, shariah_flag,
esg_flag, esg_rating, f4gbm_flag from dibots_v2.exchange_daily_transaction
where transaction_date > (select max(trading_date) from dibots_v2.ref_demography_stock)
order by transaction_date asc, stock_code asc;

--========================
-- REF_QUERY_BOARD_SECTOR
--========================

create table dibots_v2.ref_query_board_sector (
id int generated by default as identity primary key,
query_frag text,
query_desc text
);

insert into dibots_v2.ref_query_board_sector (query_frag, query_desc)
VALUES 
('and b.klciFlag = true', 'KLCI + ALL SECTOR'),
('and b.fbm100Flag = true', 'FBM100 + ALL SECTOR'),
('', 'ALL BOARD + ALL SECTOR'),
('and b.klciFlag = true and b.shariahFlag = true', 'KLCI + ALL SECTOR + SHARIAH'),
('and b.fbm100Flag = true and b.shariahFlag = true', 'FBM100 + ALL SECTOR + SHARIAH'),
('and b.shariahFlag = true', 'ALL BOARD + ALL SECTOR + SHARIAH'),
('and b.klciFlag = true and b.f4gbmFlag = true', 'KLCI + ALL SECTOR + F4GBM'),
('and b.fbm100Flag = true and b.f4gbmFlag = true', 'FBM100 + ALL SECTOR + F4GBM'),
('and b.f4gbmFlag = true', 'ALL BOARD + ALL SECTOR + F4GBM'),
('and b.klciFlag = true and b.shariahFlag = true and b.f4gbmFlag = true', 'KLCI + ALL SECTOR + SHARIAH + F4GBM'),
('and b.fbm100Flag = true and b.shariahFlag = true and b.f4gbmFlag = true', 'FBM100 + ALL SECTOR + SHARIAH + F4GBM'),
('and b.shariahFlag = true and b.f4gbmFlag = true', 'ALL BOARD + ALL SECTOR + SHARIAH + F4GBM'),
('and b.boardNum = :board', '1 BOARD + ALL SECTOR'),
('and b.boardNum = :board and b.shariahFlag = true', '1 BOARD + ALL SECTOR + SHARIAH'),
('and b.boardNum = :board and b.f4gbmFlag = true', '1 BOARD + ALL SECTOR + F4GBM'),
('and b.boardNum = :board and b.shariahFlag = true and b.f4gbmFlag = true', '1 BOARD + ALL SECTOR + SHARIAH + F4GBM'),
('and b.klciFlag = true and b.sectorNum = :sector', 'KLCI + 1 SECTOR'),
('and b.fbm100Flag = true and b.sectorNum = :sector', 'FBM100 + 1 SECTOR'),
('and b.sectorNum = :sector', 'ALL BOARD + 1 SECTOR'),
('and b.klciFlag = true and b.sectorNum = :sector and b.shariahFlag = true', 'KLCI + 1 SECTOR + SHARIAH'),
('and b.fbm100Flag = true and b.sectorNum = :sector and b.shariahFlag = true', 'FBM100 + 1 SECTOR + SHARIAH'),
('and b.sectorNum = :sector and b.shariahFlag = true', 'ALL BOARD + 1 SECTOR + SHARIAH'),
('and b.klciFlag = true and b.sectorNum = :sector and b.f4gbmFlag = true', 'KLCI + 1 SECTOR + F4GBM'),
('and b.fbm100Flag = true and b.sectorNum = :sector and b.f4gbmFlag = true', 'FBM100 + 1 SECTOR + F4GBM'),
('and b.sectorNum = :sector and b.f4gbmFlag = true', 'ALL BOARD + 1 SECTOR + F4GBM'),
('and b.klciFlag = true and b.sectorNum = :sector and b.shariahFlag = true and b.f4gbmFlag = true', 'KLCI + 1 SECTOR + SHARIAH + F4GBM'),
('and b.fbm100Flag = true and b.sectorNum = :sector and b.shariahFlag = true and b.f4gbmFlag = true', 'FBM100 + 1 SECTOR + SHARIAH + F4GBM'),
('and b.sectorNum = :sector and b.shariahFlag = true and b.f4gbmFlag = true', 'ALL BOARD + 1 SECTOR + SHARIAH + F4GBM'),
('and b.boardNum = :board and b.sectorNum = :sector', '1 BOARD + 1 SECTOR'),
('and b.boardNum = :board and b.sectorNum = :sector and b.shariahFlag = true', '1 BOARD + 1 SECTOR + SHARIAH'),
('and b.boardNum = :board and b.sectorNum = :sector and b.f4gbmFlag = true', '1 BOARD + 1 SECTOR + F4GBM'),
('and b.boardNum = :board and b.sectorNum = :sector and b.shariahFlag = true and b.f4gbmFlag = true', '1 BOARD + 1 SECTOR + SHARIAH + F4GBM');

--========================
-- REF_QUERY_GROUP_TYPE
--=======================

create table dibots_v2.ref_query_group_type (
id int generated by default as identity primary key,
api text,
api_num int,
group_type varchar(100),
group_type_num int,
vol_val_frag text,
order_frag text
);

create unique index ref_query_group_type_uniq on dibots_v2.ref_query_group_type (api_num, group_type_num);

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES 
('marketActiveVol', 1, 'ALL', 0, 'sum(a.totalVol), sum(a.totalVal),', 'sum(coalesce(a.totalVol,0)) DESC'),
('marketActiveVol', 1, 'LOCAL', 1, 'sum(a.localVol), sum(a.localVal),', 'sum(coalesce(a.localVol,0)) DESC'),
('marketActiveVol', 1, 'FOREIGN', 2, 'sum(a.foreignVol), sum(a.foreignVal),', 'sum(coalesce(a.foreignVol,0)) DESC'),
('marketActiveVol', 1, 'INST', 3, 'sum(a.instVol), sum(a.instVal),', 'sum(coalesce(a.instVol,0)) DESC'),
('marketActiveVol', 1, 'LOCAL_INST', 4, 'sum(a.localInstVol), sum(a.localInstVal),', 'sum(coalesce(a.localInstVol,0)) DESC'),
('marketActiveVol', 1, 'FOREIGN_INST', 5, 'sum(a.foreignInstVol), sum(a.foreignInstVal),', 'sum(coalesce(a.foreignInstVol,0)) DESC'),
('marketActiveVol', 1, 'RETAIL', 6, 'sum(a.retailVol), sum(a.retailVal),', 'sum(coalesce(a.retailVol,0)) DESC'),
('marketActiveVol', 1, 'LOCAL_RETAIL', 7, 'sum(a.localRetailVol), sum(a.localRetailVal),', 'sum(coalesce(a.localRetailVol,0)) DESC'),
('marketActiveVol', 1, 'FOREIGN_RETAIL', 8, 'sum(a.foreignRetailVol), sum(a.foreignRetailVal),', 'sum(coalesce(a.foreignRetailVol,0)) DESC'),
('marketActiveVol', 1, 'NOMINEES', 9, 'sum(a.nomineesVol), sum(a.nomineesVal),', 'sum(coalesce(a.nomineesVol,0)) DESC'),
('marketActiveVol', 1, 'LOCAL_NOMINEES', 10, 'sum(a.localNomineesVol), sum(a.localNomineesVal),', 'sum(coalesce(a.localNomineesVol,0)) DESC'),
('marketActiveVol', 1, 'FOREIGN_NOMINEES', 11, 'sum(a.foreignNomineesVol), sum(a.foreignNomineesVal),', 'sum(coalesce(a.foreignNomineesVol,0)) DESC'),
('marketActiveVol', 1, 'PROPRIETARY', 12, 'sum(coalesce(a.ivtVol,0) + coalesce(a.pdtVol,0)), sum(coalesce(a.ivtVal,0) + coalesce(a.pdtVal,0)),', 'sum(coalesce(a.ivtVol,0) + coalesce(a.pdtVol,0)) DESC'),
('marketActiveVol', 1, 'IVT', 13, 'sum(a.ivtVol), sum(a.ivtVal),', 'sum(coalesce(a.ivtVol,0)) DESC'),
('marketActiveVol', 1, 'PDT', 14, 'sum(a.pdtVol), sum(a.pdtVal),', 'sum(coalesce(a.pdtVol,0)) DESC'),
('marketActiveVol', 1, 'INST_NOMINEES', 15, 'sum(coalesce(a.instVol,0) + coalesce(a.nomineesVol,0)), sum(coalesce(a.instVal,0) + coalesce(a.nomineesVal,0)),', 'sum(coalesce(a.instVol,0) + coalesce(a.nomineesVol,0)) DESC'),
('marketActiveVol', 1, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.localInstVol,0) + coalesce(a.localNomineesVol,0)), sum(coalesce(a.localInstVal,0) + coalesce(a.localNomineesVal,0)),', 'sum(coalesce(a.localInstVol,0) + coalesce(a.localNomineesVol,0)) DESC'),
('marketActiveVol', 1, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.foreignInstVol,0) + coalesce(a.foreignNomineesVol,0)), sum(coalesce(a.foreignInstVal,0) + coalesce(a.foreignNomineesVal,0)),', 'sum(coalesce(a.foreignInstVol,0) + coalesce(a.foreignNomineesVol,0)) DESC'),
('marketActiveVol', 1, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.retailVol,0) + coalesce(a.nomineesVol,0)), sum(coalesce(a.retailVal,0) + coalesce(a.nomineesVal,0)),', 'sum(coalesce(a.retailVol,0) + coalesce(a.nomineesVol,0)) DESC'),
('marketActiveVol', 1, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.localRetailVol,0) + coalesce(a.localNomineesVol,0)), sum(coalesce(a.localRetailVal,0) + coalesce(a.localNomineesVal,0)),', 'sum(coalesce(a.localRetailVol,0) + coalesce(a.localNomineesVol,0)) DESC'),
('marketActiveVol', 1, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.foreignRetailVol,0) + coalesce(a.foreignNomineesVol,0)), sum(coalesce(a.foreignRetailVal,0) + coalesce(a.foreignNomineesVal,0)),', 'sum(coalesce(a.foreignRetailVol,0) + coalesce(a.foreignNomineesVol,0)) DESC');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES 
('marketActiveVal', 2, 'ALL', 0, 'sum(a.totalVol), sum(a.totalVal),', 'sum(coalesce(a.totalVal,0)) DESC'),
('marketActiveVal', 2, 'LOCAL', 1, 'sum(a.localVol), sum(a.localVal),', 'sum(coalesce(a.localVal,0)) DESC'),
('marketActiveVal', 2, 'FOREIGN', 2, 'sum(a.foreignVol), sum(a.foreignVal),', 'sum(coalesce(a.foreignVal,0)) DESC'),
('marketActiveVal', 2, 'INST', 3, 'sum(a.instVol), sum(a.instVal),', 'sum(coalesce(a.instVal,0)) DESC'),
('marketActiveVal', 2, 'LOCAL_INST', 4, 'sum(a.localInstVol), sum(a.localInstVal),', 'sum(coalesce(a.localInstVal,0)) DESC'),
('marketActiveVal', 2, 'FOREIGN_INST', 5, 'sum(a.foreignInstVol), sum(a.foreignInstVal),', 'sum(coalesce(a.foreignInstVal,0)) DESC'),
('marketActiveVal', 2, 'RETAIL', 6, 'sum(a.retailVol), sum(a.retailVal),', 'sum(coalesce(a.retailVal,0)) DESC'),
('marketActiveVal', 2, 'LOCAL_RETAIL', 7, 'sum(a.localRetailVol), sum(a.localRetailVal),', 'sum(coalesce(a.localRetailVal,0)) DESC'),
('marketActiveVal', 2, 'FOREIGN_RETAIL', 8, 'sum(a.foreignRetailVol), sum(a.foreignRetailVal),', 'sum(coalesce(a.foreignRetailVal,0)) DESC'),
('marketActiveVal', 2, 'NOMINEES', 9, 'sum(a.nomineesVol), sum(a.nomineesVal),', 'sum(coalesce(a.nomineesVal,0)) DESC'),
('marketActiveVal', 2, 'LOCAL_NOMINEES', 10, 'sum(a.localNomineesVol), sum(a.localNomineesVal),', 'sum(coalesce(a.localNomineesVal,0)) DESC'),
('marketActiveVal', 2, 'FOREIGN_NOMINEES', 11, 'sum(a.foreignNomineesVol), sum(a.foreignNomineesVal),', 'sum(coalesce(a.foreignNomineesVal,0)) DESC'),
('marketActiveVal', 2, 'PROPRIETARY', 12, 'sum(coalesce(a.ivtVol,0) + coalesce(a.pdtVol,0)), sum(coalesce(a.ivtVal,0) + coalesce(a.pdtVal,0)),', 'sum(coalesce(a.ivtVal,0) + coalesce(a.pdtVal,0)) DESC'),
('marketActiveVal', 2, 'IVT', 13, 'sum(a.ivtVol), sum(a.ivtVal),', 'sum(coalesce(a.ivtVal,0)) DESC'),
('marketActiveVal', 2, 'PDT', 14, 'sum(a.pdtVol), sum(a.pdtVal),', 'sum(coalesce(a.pdtVal,0)) DESC'),
('marketActiveVal', 2, 'INST_NOMINEES', 15, 'sum(coalesce(a.instVol,0) + coalesce(a.nomineesVol,0)), sum(coalesce(a.instVal,0) + coalesce(a.nomineesVal,0)),', 'sum(coalesce(a.instVal,0) + coalesce(a.nomineesVal,0)) DESC'),
('marketActiveVal', 2, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.localInstVol,0) + coalesce(a.localNomineesVol,0)), sum(coalesce(a.localInstVal,0) + coalesce(a.localNomineesVal,0)),', 'sum(coalesce(a.localInstVal,0) + coalesce(a.localNomineesVal,0)) DESC'),
('marketActiveVal', 2, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.foreignInstVol,0) + coalesce(a.foreignNomineesVol,0)), sum(coalesce(a.foreignInstVal,0) + coalesce(a.foreignNomineesVal,0)),', 'sum(coalesce(a.foreignInstVal,0) + coalesce(a.foreignNomineesVal,0)) DESC'),
('marketActiveVal', 2, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.retailVol,0) + coalesce(a.nomineesVol,0)), sum(coalesce(a.retailVal,0) + coalesce(a.nomineesVal,0)),', 'sum(coalesce(a.retailVal,0) + coalesce(a.nomineesVal,0)) DESC'),
('marketActiveVal', 2, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.localRetailVol,0) + coalesce(a.localNomineesVol,0)), sum(coalesce(a.localRetailVal,0) + coalesce(a.localNomineesVal,0)),', 'sum(coalesce(a.localRetailVal,0) + coalesce(a.localNomineesVal,0)) DESC'),
('marketActiveVal', 2, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.foreignRetailVol,0) + coalesce(a.foreignNomineesVol,0)), sum(coalesce(a.foreignRetailVal,0) + coalesce(a.foreignNomineesVal,0)),', 'sum(coalesce(a.foreignRetailVal,0) + coalesce(a.foreignNomineesVal,0)) DESC');


insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES
('marketNetBuyVal', 3, 'ALL', 0, 'sum(GREATEST(a.netLocalInstVol,0) + GREATEST(a.netLocalRetailVol,0) + GREATEST(a.netLocalNomineesVol,0) + GREATEST(a.netForeignVol,0) + GREATEST(a.netIvtVol,0) + GREATEST(a.netPdtVol,0)), sum(GREATEST(a.netLocalInstVal,0) + GREATEST(a.netLocalRetailVal,0) + GREATEST(a.netLocalNomineesVal,0) + GREATEST(a.netForeignVal,0) + GREATEST(a.netIvtVal,0) + GREATEST(a.netPdtVal,0)),', 'sum(GREATEST(a.netLocalInstVal,0) + GREATEST(a.netLocalRetailVal,0) + GREATEST(a.netLocalNomineesVal,0) + GREATEST(a.netForeignVal,0) + GREATEST(a.netIvtVal,0) + GREATEST(a.netPdtVal,0)) DESC'),
('marketNetBuyVal', 3, 'LOCAL', 1, 'sum(a.netLocalVol), sum(a.netLocalVal),', 'sum(coalesce(a.netLocalVal,0)) DESC'),
('marketNetBuyVal', 3, 'FOREIGN', 2, 'sum(a.netForeignVol), sum(a.netForeignVal),', 'sum(coalesce(a.netForeignVal,0)) DESC'),
('marketNetBuyVal', 3, 'INST', 3, 'sum(a.netInstVol), sum(a.netInstVal),', 'sum(coalesce(a.netInstVal,0)) DESC'),
('marketNetBuyVal', 3, 'LOCAL_INST', 4, 'sum(a.netLocalInstVol), sum(a.netLocalInstVal),', 'sum(coalesce(a.netLocalInstVal,0)) DESC'),
('marketNetBuyVal', 3, 'FOREIGN_INST', 5, 'sum(a.netForeignInstVol), sum(a.netForeignInstVal),', 'sum(coalesce(a.netForeignInstVal,0)) DESC'),
('marketNetBuyVal', 3, 'RETAIL', 6, 'sum(a.netRetailVol), sum(a.netRetailVal),', 'sum(coalesce(a.netRetailVal,0)) DESC'),
('marketNetBuyVal', 3, 'LOCAL_RETAIL', 7, 'sum(a.netLocalRetailVol), sum(a.netLocalRetailVal),', 'sum(coalesce(a.netLocalRetailVal,0)) DESC'),
('marketNetBuyVal', 3, 'FOREIGN_RETAIL', 8, 'sum(a.netForeignRetailVol), sum(a.netForeignRetailVal),', 'sum(coalesce(a.netForeignRetailVal,0)) DESC'),
('marketNetBuyVal', 3, 'NOMINEES', 9, 'sum(a.netNomineesVol), sum(a.netNomineesVal),', 'sum(coalesce(a.netNomineesVal,0)) DESC'),
('marketNetBuyVal', 3, 'LOCAL_NOMINEES', 10, 'sum(a.netLocalNomineesVol), sum(a.netLocalNomineesVal),', 'sum(coalesce(a.netLocalNomineesVal,0)) DESC'),
('marketNetBuyVal', 3, 'FOREIGN_NOMINEES', 11, 'sum(a.netForeignNomineesVol), sum(a.netForeignNomineesVal),', 'sum(coalesce(a.netForeignNomineesVal,0)) DESC'),
('marketNetBuyVal', 3, 'PROPRIETARY', 12, 'sum(coalesce(a.netIvtVol,0) + coalesce(a.netPdtVol,0)), sum(coalesce(a.netIvtVal,0) + coalesce(a.netPdtVal,0)),', 'sum(coalesce(a.netIvtVal,0) + coalesce(a.netPdtVal,0)) DESC'),
('marketNetBuyVal', 3, 'IVT', 13, 'sum(a.netIvtVol), sum(a.netIvtVal),', 'sum(coalesce(a.netIvtVal,0)) DESC'),
('marketNetBuyVal', 3, 'PDT', 14, 'sum(a.netPdtVol), sum(a.netPdtVal),', 'sum(coalesce(a.netPdtVal,0)) DESC'),
('marketNetBuyVal', 3, 'INST_NOMINEES', 15, 'sum(coalesce(a.netInstVol,0) + coalesce(a.netNomineesVol,0)), sum(coalesce(a.netInstVal,0) + coalesce(a.netNomineesVal,0)),', 'sum(coalesce(a.netInstVal,0) + coalesce(a.netNomineesVal,0)) DESC'),
('marketNetBuyVal', 3, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.netLocalInstVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)) DESC'),
('marketNetBuyVal', 3, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.netForeignInstVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)) DESC'),
('marketNetBuyVal', 3, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.netRetailVol,0) + coalesce(a.netNomineesVol,0)), sum(coalesce(a.netRetailVal,0) + coalesce(a.netNomineesVal,0)),', 'sum(coalesce(a.netRetailVal,0) + coalesce(a.netNomineesVal,0)) DESC'),
('marketNetBuyVal', 3, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.netLocalRetailVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)) DESC'),
('marketNetBuyVal', 3, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.netForeignRetailVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)) DESC');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES
('marketNetSellVal', 4, 'ALL', 0, 'sum(LEAST(a.netLocalInstVol,0) + LEAST(a.netLocalRetailVol,0) + LEAST(a.netLocalNomineesVol,0) + LEAST(a.netForeignVol,0) + LEAST(a.netIvtVol,0) + LEAST(a.netPdtVol,0)), sum(LEAST(a.netLocalInstVal,0) + LEAST(a.netLocalRetailVal,0) + LEAST(a.netLocalNomineesVal,0) + LEAST(a.netForeignVal,0) + LEAST(a.netIvtVal,0) + LEAST(a.netPdtVal,0)),', 'sum(LEAST(a.netLocalInstVal,0) + LEAST(a.netLocalRetailVal,0) + LEAST(a.netLocalNomineesVal,0) + LEAST(a.netForeignVal,0) + LEAST(a.netIvtVal,0) + LEAST(a.netPdtVal,0)) ASC'),
('marketNetSellVal', 4, 'LOCAL', 1, 'sum(a.netLocalVol), sum(a.netLocalVal),', 'sum(coalesce(a.netLocalVal,0)) ASC'),
('marketNetSellVal', 4, 'FOREIGN', 2, 'sum(a.netForeignVol), sum(a.netForeignVal),', 'sum(coalesce(a.netForeignVal,0)) ASC'),
('marketNetSellVal', 4, 'INST', 3, 'sum(a.netInstVol), sum(a.netInstVal),', 'sum(coalesce(a.netInstVal,0)) ASC'),
('marketNetSellVal', 4, 'LOCAL_INST', 4, 'sum(a.netLocalInstVol), sum(a.netLocalInstVal),', 'sum(coalesce(a.netLocalInstVal,0)) ASC'),
('marketNetSellVal', 4, 'FOREIGN_INST', 5, 'sum(a.netForeignInstVol), sum(a.netForeignInstVal),', 'sum(coalesce(a.netForeignInstVal,0)) ASC'),
('marketNetSellVal', 4, 'RETAIL', 6, 'sum(a.netRetailVol), sum(a.netRetailVal),', 'sum(coalesce(a.netRetailVal,0)) ASC'),
('marketNetSellVal', 4, 'LOCAL_RETAIL', 7, 'sum(a.netLocalRetailVol), sum(a.netLocalRetailVal),', 'sum(coalesce(a.netLocalRetailVal,0)) ASC'),
('marketNetSellVal', 4, 'FOREIGN_RETAIL', 8, 'sum(a.netForeignRetailVol), sum(a.netForeignRetailVal),', 'sum(coalesce(a.netForeignRetailVal,0)) ASC'),
('marketNetSellVal', 4, 'NOMINEES', 9, 'sum(a.netNomineesVol), sum(a.netNomineesVal),', 'sum(coalesce(a.netNomineesVal,0)) ASC'),
('marketNetSellVal', 4, 'LOCAL_NOMINEES', 10, 'sum(a.netLocalNomineesVol), sum(a.netLocalNomineesVal),', 'sum(coalesce(a.netLocalNomineesVal,0)) ASC'),
('marketNetSellVal', 4, 'FOREIGN_NOMINEES', 11, 'sum(a.netForeignNomineesVol), sum(a.netForeignNomineesVal),', 'sum(coalesce(a.netForeignNomineesVal,0)) ASC'),
('marketNetSellVal', 4, 'PROPRIETARY', 12, 'sum(coalesce(a.netIvtVol,0) + coalesce(a.netPdtVol,0)), sum(coalesce(a.netIvtVal,0) + coalesce(a.netPdtVal,0)),', 'sum(coalesce(a.netIvtVal,0) + coalesce(a.netPdtVal,0)) ASC'),
('marketNetSellVal', 4, 'IVT', 13, 'sum(a.netIvtVol), sum(a.netIvtVal),', 'sum(coalesce(a.netIvtVal,0)) ASC'),
('marketNetSellVal', 4, 'PDT', 14, 'sum(a.netPdtVol), sum(a.netPdtVal),', 'sum(coalesce(a.netPdtVal,0)) ASC'),
('marketNetSellVal', 4, 'INST_NOMINEES', 15, 'sum(coalesce(a.netInstVol,0) + coalesce(a.netNomineesVol,0)), sum(coalesce(a.netInstVal,0) + coalesce(a.netNomineesVal,0)),', 'sum(coalesce(a.netInstVal,0) + coalesce(a.netNomineesVal,0)) ASC'),
('marketNetSellVal', 4, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.netLocalInstVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)) ASC'),
('marketNetSellVal', 4, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.netForeignInstVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)) ASC'),
('marketNetSellVal', 4, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.netRetailVol,0) + coalesce(a.netNomineesVol,0)), sum(coalesce(a.netRetailVal,0) + coalesce(a.netNomineesVal,0)),', 'sum(coalesce(a.netRetailVal,0) + coalesce(a.netNomineesVal,0)) ASC'),
('marketNetSellVal', 4, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.netLocalRetailVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)) ASC'),
('marketNetSellVal', 4, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.netForeignRetailVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)) ASC');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES
('marketNetBuyVol', 5, 'ALL', 0, 'sum(GREATEST(a.netLocalInstVol,0) + GREATEST(a.netLocalRetailVol,0) + GREATEST(a.netLocalNomineesVol,0) + GREATEST(a.netForeignVol,0) + GREATEST(a.netIvtVol,0) + GREATEST(a.netPdtVol,0)), sum(GREATEST(a.netLocalInstVal,0) + GREATEST(a.netLocalRetailVal,0) + GREATEST(a.netLocalNomineesVal,0) + GREATEST(a.netForeignVal,0) + GREATEST(a.netIvtVal,0) + GREATEST(a.netPdtVal,0)),', 'sum(GREATEST(a.netLocalInstVol,0) + GREATEST(a.netLocalRetailVol,0) + GREATEST(a.netLocalNomineesVol,0) + GREATEST(a.netForeignVol,0) + GREATEST(a.netIvtVol,0) + GREATEST(a.netPdtVol,0)) DESC'),
('marketNetBuyVol', 5, 'LOCAL', 1, 'sum(a.netLocalVol), sum(a.netLocalVal),', 'sum(coalesce(a.netLocalVol,0)) DESC'),
('marketNetBuyVol', 5, 'FOREIGN', 2, 'sum(a.netForeignVol), sum(a.netForeignVal),', 'sum(coalesce(a.netForeignVol,0)) DESC'),
('marketNetBuyVol', 5, 'INST', 3, 'sum(a.netInstVol), sum(a.netInstVal),', 'sum(coalesce(a.netInstVol,0)) DESC'),
('marketNetBuyVol', 5, 'LOCAL_INST', 4, 'sum(a.netLocalInstVol), sum(a.netLocalInstVal),', 'sum(coalesce(a.netLocalInstVol,0)) DESC'),
('marketNetBuyVol', 5, 'FOREIGN_INST', 5, 'sum(a.netForeignInstVol), sum(a.netForeignInstVal),', 'sum(coalesce(a.netForeignInstVol,0)) DESC'),
('marketNetBuyVol', 5, 'RETAIL', 6, 'sum(a.netRetailVol), sum(a.netRetailVal),', 'sum(coalesce(a.netRetailVol,0)) DESC'),
('marketNetBuyVol', 5, 'LOCAL_RETAIL', 7, 'sum(a.netLocalRetailVol), sum(a.netLocalRetailVal),', 'sum(coalesce(a.netLocalRetailVol,0)) DESC'),
('marketNetBuyVol', 5, 'FOREIGN_RETAIL', 8, 'sum(a.netForeignRetailVol), sum(a.netForeignRetailVal),', 'sum(coalesce(a.netForeignRetailVol,0)) DESC'),
('marketNetBuyVol', 5, 'NOMINEES', 9, 'sum(a.netNomineesVol), sum(a.netNomineesVal),', 'sum(coalesce(a.netNomineesVol,0)) DESC'),
('marketNetBuyVol', 5, 'LOCAL_NOMINEES', 10, 'sum(a.netLocalNomineesVol), sum(a.netLocalNomineesVal),', 'sum(coalesce(a.netLocalNomineesVol,0)) DESC'),
('marketNetBuyVol', 5, 'FOREIGN_NOMINEES', 11, 'sum(a.netForeignNomineesVol), sum(a.netForeignNomineesVal),', 'sum(coalesce(a.netForeignNomineesVol,0)) DESC'),
('marketNetBuyVol', 5, 'PROPRIETARY', 12, 'sum(coalesce(a.netIvtVol,0) + coalesce(a.netPdtVol,0)), sum(coalesce(a.netIvtVal,0) + coalesce(a.netPdtVal,0)),', 'sum(coalesce(a.netIvtVol,0) + coalesce(a.netPdtVol,0)) DESC'),
('marketNetBuyVol', 5, 'IVT', 13, 'sum(a.netIvtVol), sum(a.netIvtVal),', 'sum(coalesce(a.netIvtVol,0)) DESC'),
('marketNetBuyVol', 5, 'PDT', 14, 'sum(a.netPdtVol), sum(a.netPdtVal),', 'sum(coalesce(a.netPdtVol,0)) DESC'),
('marketNetBuyVol', 5, 'INST_NOMINEES', 15, 'sum(coalesce(a.netInstVol,0) + coalesce(a.netNomineesVol,0)), sum(coalesce(a.netInstVal,0) + coalesce(a.netNomineesVal,0)),', 'sum(coalesce(a.netInstVol,0) + coalesce(a.netNomineesVol,0)) DESC'),
('marketNetBuyVol', 5, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.netLocalInstVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalInstVol,0) + coalesce(a.netLocalNomineesVol,0)) DESC'),
('marketNetBuyVol', 5, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.netForeignInstVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignInstVol,0) + coalesce(a.netForeignNomineesVol,0)) DESC'),
('marketNetBuyVol', 5, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.netRetailVol,0) + coalesce(a.netNomineesVol,0)), sum(coalesce(a.netRetailVal,0) + coalesce(a.netNomineesVal,0)),', 'sum(coalesce(a.netRetailVol,0) + coalesce(a.netNomineesVol,0)) DESC'),
('marketNetBuyVol', 5, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.netLocalRetailVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalRetailVol,0) + coalesce(a.netLocalNomineesVol,0)) DESC'),
('marketNetBuyVol', 5, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.netForeignRetailVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignRetailVol,0) + coalesce(a.netForeignNomineesVol,0)) DESC');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES
('marketNetSellVol', 6, 'ALL', 0, 'sum(LEAST(a.netLocalInstVol,0) + LEAST(a.netLocalRetailVol,0) + LEAST(a.netLocalNomineesVol,0) + LEAST(a.netForeignVol,0) + LEAST(a.netIvtVol,0) + LEAST(a.netPdtVol,0)), sum(LEAST(a.netLocalInstVal,0) + LEAST(a.netLocalRetailVal,0) + LEAST(a.netLocalNomineesVal,0) + LEAST(a.netForeignVal,0) + LEAST(a.netIvtVal,0) + LEAST(a.netPdtVal,0)),', 'sum(LEAST(a.netLocalInstVol,0) + LEAST(a.netLocalRetailVol,0) + LEAST(a.netLocalNomineesVol,0) + LEAST(a.netForeignVol,0) + LEAST(a.netIvtVol,0) + LEAST(a.netPdtVol,0)) ASC'),
('marketNetSellVol', 6, 'LOCAL', 1, 'sum(a.netLocalVol), sum(a.netLocalVal),', 'sum(coalesce(a.netLocalVol,0)) ASC'),
('marketNetSellVol', 6, 'FOREIGN', 2, 'sum(a.netForeignVol), sum(a.netForeignVal),', 'sum(coalesce(a.netForeignVol,0)) ASC'),
('marketNetSellVol', 6, 'INST', 3, 'sum(a.netInstVol), sum(a.netInstVal),', 'sum(coalesce(a.netInstVol,0)) ASC'),
('marketNetSellVol', 6, 'LOCAL_INST', 4, 'sum(a.netLocalInstVol), sum(a.netLocalInstVal),', 'sum(coalesce(a.netLocalInstVol,0)) ASC'),
('marketNetSellVol', 6, 'FOREIGN_INST', 5, 'sum(a.netForeignInstVol), sum(a.netForeignInstVal),', 'sum(coalesce(a.netForeignInstVol,0)) ASC'),
('marketNetSellVol', 6, 'RETAIL', 6, 'sum(a.netRetailVol), sum(a.netRetailVal),', 'sum(coalesce(a.netRetailVol,0)) ASC'),
('marketNetSellVol', 6, 'LOCAL_RETAIL', 7, 'sum(a.netLocalRetailVol), sum(a.netLocalRetailVal),', 'sum(coalesce(a.netLocalRetailVol,0)) ASC'),
('marketNetSellVol', 6, 'FOREIGN_RETAIL', 8, 'sum(a.netForeignRetailVol), sum(a.netForeignRetailVal),', 'sum(coalesce(a.netForeignRetailVol,0)) ASC'),
('marketNetSellVol', 6, 'NOMINEES', 9, 'sum(a.netNomineesVol), sum(a.netNomineesVal),', 'sum(coalesce(a.netNomineesVol,0)) ASC'),
('marketNetSellVol', 6, 'LOCAL_NOMINEES', 10, 'sum(a.netLocalNomineesVol), sum(a.netLocalNomineesVal),', 'sum(coalesce(a.netLocalNomineesVol,0)) ASC'),
('marketNetSellVol', 6, 'FOREIGN_NOMINEES', 11, 'sum(a.netForeignNomineesVol), sum(a.netForeignNomineesVal),', 'sum(coalesce(a.netForeignNomineesVol,0)) ASC'),
('marketNetSellVol', 6, 'PROPRIETARY', 12, 'sum(coalesce(a.netIvtVol,0) + coalesce(a.netPdtVol,0)), sum(coalesce(a.netIvtVal,0) + coalesce(a.netPdtVal,0)),', 'sum(coalesce(a.netIvtVol,0) + coalesce(a.netPdtVol,0)) ASC'),
('marketNetSellVol', 6, 'IVT', 13, 'sum(a.netIvtVol), sum(a.netIvtVal),', 'sum(coalesce(a.netIvtVol,0)) ASC'),
('marketNetSellVol', 6, 'PDT', 14, 'sum(a.netPdtVol), sum(a.netPdtVal),', 'sum(coalesce(a.netPdtVol,0)) ASC'),
('marketNetSellVol', 6, 'INST_NOMINEES', 15, 'sum(coalesce(a.netInstVol,0) + coalesce(a.netNomineesVol,0)), sum(coalesce(a.netInstVal,0) + coalesce(a.netNomineesVal,0)),', 'sum(coalesce(a.netInstVol,0) + coalesce(a.netNomineesVol,0)) ASC'),
('marketNetSellVol', 6, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.netLocalInstVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalInstVol,0) + coalesce(a.netLocalNomineesVol,0)) ASC'),
('marketNetSellVol', 6, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.netForeignInstVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignInstVol,0) + coalesce(a.netForeignNomineesVol,0)) ASC'),
('marketNetSellVol', 6, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.netRetailVol,0) + coalesce(a.netNomineesVol,0)), sum(coalesce(a.netRetailVal,0) + coalesce(a.netNomineesVal,0)),', 'sum(coalesce(a.netRetailVol,0) + coalesce(a.netNomineesVol,0)) ASC'),
('marketNetSellVol', 6, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.netLocalRetailVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalRetailVol,0) + coalesce(a.netLocalNomineesVol,0)) ASC'),
('marketNetSellVol', 6, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.netForeignRetailVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignRetailVol,0) + coalesce(a.netForeignNomineesVol,0)) ASC');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES
('marketIntradayVol', 7, 'ALL', 0, 'sum(a.totalIntradayVol), sum(a.totalIntradayVal),', 'sum(coalesce(a.totalIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'LOCAL', 1, 'sum(a.localIntradayVol), sum(a.localIntradayVal),', 'sum(coalesce(a.localIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'FOREIGN', 2, 'sum(a.foreignIntradayVol), sum(a.foreignIntradayVal),', 'sum(coalesce(a.foreignIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'INST', 3, 'sum(a.instIntradayVol), sum(a.instIntradayVal),', 'sum(coalesce(a.instIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'LOCAL_INST', 4, 'sum(a.localInstIntradayVol), sum(a.localInstIntradayVal),', 'sum(coalesce(a.localInstIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'FOREIGN_INST', 5, 'sum(a.foreignInstIntradayVol), sum(a.foreignInstIntradayVal),', 'sum(coalesce(a.foreignInstIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'RETAIL', 6, 'sum(a.retailIntradayVol), sum(a.retailIntradayVal),', 'sum(coalesce(a.retailIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'LOCAL_RETAIL', 7, 'sum(a.localRetailIntradayVol), sum(a.localRetailIntradayVal),', 'sum(coalesce(a.localRetailIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'FOREIGN_RETAIL', 8, 'sum(a.foreignRetailIntradayVol), sum(a.foreignRetailIntradayVal),', 'sum(coalesce(a.foreignRetailIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'NOMINEES', 9, 'sum(a.nomineesIntradayVol), sum(a.nomineesIntradayVal),', 'sum(coalesce(a.nomineesIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'LOCAL_NOMINEES', 10, 'sum(a.localNomineesIntradayVol), sum(a.localNomineesIntradayVal),', 'sum(coalesce(a.localNomineesIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'FOREIGN_NOMINEES', 11, 'sum(a.foreignNomineesIntradayVol), sum(a.foreignNomineesIntradayVal),', 'sum(coalesce(a.foreignNomineesIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'PROPRIETARY', 12, 'sum(coalesce(a.ivtIntradayVol,0) + coalesce(a.pdtIntradayVol,0)), sum(coalesce(a.ivtIntradayVal,0) + coalesce(a.pdtIntradayVal,0)),', 'sum(coalesce(a.ivtIntradayVol,0) + coalesce(a.pdtIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'IVT', 13, 'sum(a.ivtIntradayVol), sum(a.ivtIntradayVal),', 'sum(coalesce(a.ivtIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'PDT', 14, 'sum(a.pdtIntradayVol), sum(a.pdtIntradayVal),', 'sum(coalesce(a.pdtIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'INST_NOMINEES', 15, 'sum(coalesce(a.instIntradayVol,0) + coalesce(a.nomineesIntradayVol,0)), sum(coalesce(a.instIntradayVal,0) + coalesce(a.nomineesIntradayVal,0)),', 'sum(coalesce(a.instIntradayVol,0) + coalesce(a.nomineesIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.localInstIntradayVol,0) + coalesce(a.localNomineesIntradayVol,0)), sum(coalesce(a.localInstIntradayVal,0) + coalesce(a.localNomineesIntradayVal,0)),', 'sum(coalesce(a.localInstIntradayVol,0) + coalesce(a.localNomineesIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.foreignInstIntradayVol,0) + coalesce(a.foreignNomineesIntradayVol,0)), sum(coalesce(a.foreignInstIntradayVal,0) + coalesce(a.foreignNomineesIntradayVal,0)),', 'sum(coalesce(a.foreignInstIntradayVol,0) + coalesce(a.foreignNomineesIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.retailIntradayVol,0) + coalesce(a.nomineesIntradayVol,0)), sum(coalesce(a.retailIntradayVal,0) + coalesce(a.nomineesIntradayVal,0)),', 'sum(coalesce(a.retailIntradayVol,0) + coalesce(a.nomineesIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.localRetailIntradayVol,0) + coalesce(a.localNomineesIntradayVol,0)), sum(coalesce(a.localRetailIntradayVal,0) + coalesce(a.localNomineesIntradayVal,0)),', 'sum(coalesce(a.localRetailIntradayVol,0) + coalesce(a.localNomineesIntradayVol,0)) DESC'),
('marketIntradayVol', 7, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.foreignRetailIntradayVol,0) + coalesce(a.foreignNomineesIntradayVol,0)), sum(coalesce(a.foreignRetailIntradayVal,0) + coalesce(a.foreignNomineesIntradayVal,0)),', 'sum(coalesce(a.foreignRetailIntradayVol,0) + coalesce(a.foreignNomineesIntradayVol,0)) DESC');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES
('marketIntradayVal', 8, 'ALL', 0, 'sum(a.totalIntradayVol), sum(a.totalIntradayVal),', 'sum(coalesce(a.totalIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'LOCAL', 1, 'sum(a.localIntradayVol), sum(a.localIntradayVal),', 'sum(coalesce(a.localIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'FOREIGN', 2, 'sum(a.foreignIntradayVol), sum(a.foreignIntradayVal),', 'sum(coalesce(a.foreignIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'INST', 3, 'sum(a.instIntradayVol), sum(a.instIntradayVal),', 'sum(coalesce(a.instIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'LOCAL_INST', 4, 'sum(a.localInstIntradayVol), sum(a.localInstIntradayVal),', 'sum(coalesce(a.localInstIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'FOREIGN_INST', 5, 'sum(a.foreignInstIntradayVol), sum(a.foreignInstIntradayVal),', 'sum(coalesce(a.foreignInstIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'RETAIL', 6, 'sum(a.retailIntradayVol), sum(a.retailIntradayVal),', 'sum(coalesce(a.retailIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'LOCAL_RETAIL', 7, 'sum(a.localRetailIntradayVol), sum(a.localRetailIntradayVal),', 'sum(coalesce(a.localRetailIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'FOREIGN_RETAIL', 8, 'sum(a.foreignRetailIntradayVol), sum(a.foreignRetailIntradayVal),', 'sum(coalesce(a.foreignRetailIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'NOMINEES', 9, 'sum(a.nomineesIntradayVol), sum(a.nomineesIntradayVal),', 'sum(coalesce(a.nomineesIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'LOCAL_NOMINEES', 10, 'sum(a.localNomineesIntradayVol), sum(a.localNomineesIntradayVal),', 'sum(coalesce(a.localNomineesIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'FOREIGN_NOMINEES', 11, 'sum(a.foreignNomineesIntradayVol), sum(a.foreignNomineesIntradayVal),', 'sum(coalesce(a.foreignNomineesIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'PROPRIETARY', 12, 'sum(coalesce(a.ivtIntradayVol,0) + coalesce(a.pdtIntradayVol,0)), sum(coalesce(a.ivtIntradayVal,0) + coalesce(a.pdtIntradayVal,0)),', 'sum(coalesce(a.ivtIntradayVal,0) + coalesce(a.pdtIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'IVT', 13, 'sum(a.ivtIntradayVol), sum(a.ivtIntradayVal),', 'sum(coalesce(a.ivtIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'PDT', 14, 'sum(a.pdtIntradayVol), sum(a.pdtIntradayVal),', 'sum(coalesce(a.pdtIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'INST_NOMINEES', 15, 'sum(coalesce(a.instIntradayVol,0) + coalesce(a.nomineesIntradayVol,0)), sum(coalesce(a.instIntradayVal,0) + coalesce(a.nomineesIntradayVal,0)),', 'sum(coalesce(a.instIntradayVal,0) + coalesce(a.nomineesIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.localInstIntradayVol,0) + coalesce(a.localNomineesIntradayVol,0)), sum(coalesce(a.localInstIntradayVal,0) + coalesce(a.localNomineesIntradayVal,0)),', 'sum(coalesce(a.localInstIntradayVal,0) + coalesce(a.localNomineesIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.foreignInstIntradayVol,0) + coalesce(a.foreignNomineesIntradayVol,0)), sum(coalesce(a.foreignInstIntradayVal,0) + coalesce(a.foreignNomineesIntradayVal,0)),', 'sum(coalesce(a.foreignInstIntradayVal,0) + coalesce(a.foreignNomineesIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.retailIntradayVol,0) + coalesce(a.nomineesIntradayVol,0)), sum(coalesce(a.retailIntradayVal,0) + coalesce(a.nomineesIntradayVal,0)),', 'sum(coalesce(a.retailIntradayVal,0) + coalesce(a.nomineesIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.localRetailIntradayVol,0) + coalesce(a.localNomineesIntradayVol,0)), sum(coalesce(a.localRetailIntradayVal,0) + coalesce(a.localNomineesIntradayVal,0)),', 'sum(coalesce(a.localRetailIntradayVal,0) + coalesce(a.localNomineesIntradayVal,0)) DESC'),
('marketIntradayVal', 8, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.foreignRetailIntradayVol,0) + coalesce(a.foreignNomineesIntradayVol,0)), sum(coalesce(a.foreignRetailIntradayVal,0) + coalesce(a.foreignNomineesIntradayVal,0)),', 'sum(coalesce(a.foreignRetailIntradayVal,0) + coalesce(a.foreignNomineesIntradayVal,0)) DESC');


insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES
('marketContraVal', 9, 'ALL', 0, 'SUM(COALESCE(a.t2OpenVolNext,0)-COALESCE(a.t1OpenVol,0)+COALESCE(a.t3OpenVolNext,0)-COALESCE(a.t2OpenVol,0)), SUM(COALESCE(a.t2OpenValNext,0)-COALESCE(a.t1OpenVal,0)+COALESCE(a.t3OpenValNext,0)-COALESCE(a.t2OpenVal,0))', 'SUM(COALESCE(a.t2OpenValNext,0)-COALESCE(a.t1OpenVal,0)+COALESCE(a.t3OpenValNext,0)-COALESCE(a.t2OpenVal,0)) ASC'),
('marketContraVal', 9, 'LOCAL', 1, 'SUM(COALESCE(a.localT2OpenVolNext,0)-COALESCE(a.localT1OpenVol,0)+COALESCE(a.localT3OpenVolNext,0)-COALESCE(a.localT2OpenVol,0)), SUM(COALESCE(a.localT2OpenValNext,0)-COALESCE(a.localT1OpenVal,0)+COALESCE(a.localT3OpenValNext,0)-COALESCE(a.localT2OpenVal,0))', 'SUM(COALESCE(a.localT2OpenValNext,0)-COALESCE(a.localT1OpenVal,0)+COALESCE(a.localT3OpenValNext,0)-COALESCE(a.localT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'FOREIGN', 2, 'SUM(COALESCE(a.foreignT2OpenVolNext,0)-COALESCE(a.foreignT1OpenVol,0)+COALESCE(a.foreignT3OpenVolNext,0)-COALESCE(a.foreignT2OpenVol,0)), SUM(COALESCE(a.foreignT2OpenValNext,0)-COALESCE(a.foreignT1OpenVal,0)+COALESCE(a.foreignT3OpenValNext,0)-COALESCE(a.foreignT2OpenVal,0))', 'SUM(COALESCE(a.foreignT2OpenValNext,0)-COALESCE(a.foreignT1OpenVal,0)+COALESCE(a.foreignT3OpenValNext,0)-COALESCE(a.foreignT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'INST', 3, 'SUM(COALESCE(a.instT2OpenVolNext,0)-COALESCE(a.instT1OpenVol,0)+COALESCE(a.instT3OpenVolNext,0)-COALESCE(a.instT2OpenVol,0)), SUM(COALESCE(a.instT2OpenValNext,0)-COALESCE(a.instT1OpenVal,0)+COALESCE(a.instT3OpenValNext,0)-COALESCE(a.instT2OpenVal,0))', 'SUM(COALESCE(a.instT2OpenValNext,0)-COALESCE(a.instT1OpenVal,0)+COALESCE(a.instT3OpenValNext,0)-COALESCE(a.instT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'LOCAL_INST', 4, 'SUM(COALESCE(a.localInstT2OpenVolNext,0)-COALESCE(a.localInstT1OpenVol,0)+COALESCE(a.localInstT3OpenVolNext,0)-COALESCE(a.localInstT2OpenVol,0)), SUM(COALESCE(a.localInstT2OpenValNext,0)-COALESCE(a.localInstT1OpenVal,0)+COALESCE(a.localInstT3OpenValNext,0)-COALESCE(a.localInstT2OpenVal,0))', 'SUM(COALESCE(a.localInstT2OpenValNext,0)-COALESCE(a.localInstT1OpenVal,0)+COALESCE(a.localInstT3OpenValNext,0)-COALESCE(a.localInstT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'FOREIGN_INST', 5, 'SUM(COALESCE(a.foreignInstT2OpenVolNext,0)-COALESCE(a.foreignInstT1OpenVol,0)+COALESCE(a.foreignInstT3OpenVolNext,0)-COALESCE(a.foreignInstT2OpenVol,0)), SUM(COALESCE(a.foreignInstT2OpenValNext,0)-COALESCE(a.foreignInstT1OpenVal,0)+COALESCE(a.foreignInstT3OpenValNext,0)-COALESCE(a.foreignInstT2OpenVal,0))', 'SUM(COALESCE(a.foreignInstT2OpenValNext,0)-COALESCE(a.foreignInstT1OpenVal,0)+COALESCE(a.foreignInstT3OpenValNext,0)-COALESCE(a.foreignInstT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'RETAIL', 6, 'SUM(COALESCE(a.retailT2OpenVolNext,0)-COALESCE(a.retailT1OpenVol,0)+COALESCE(a.retailT3OpenVolNext,0)-COALESCE(a.retailT2OpenVol,0)), SUM(COALESCE(a.retailT2OpenValNext,0)-COALESCE(a.retailT1OpenVal,0)+COALESCE(a.retailT3OpenValNext,0)-COALESCE(a.retailT2OpenVal,0))', 'SUM(COALESCE(a.retailT2OpenValNext,0)-COALESCE(a.retailT1OpenVal,0)+COALESCE(a.retailT3OpenValNext,0)-COALESCE(a.retailT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'LOCAL_RETAIL', 7, 'SUM(COALESCE(a.localRetailT2OpenVolNext,0)-COALESCE(a.localRetailT1OpenVol,0)+COALESCE(a.localRetailT3OpenVolNext,0)-COALESCE(a.localRetailT2OpenVol,0)), SUM(COALESCE(a.localRetailT2OpenValNext,0)-COALESCE(a.localRetailT1OpenVal,0)+COALESCE(a.localRetailT3OpenValNext,0)-COALESCE(a.localRetailT2OpenVal,0))', 'SUM(COALESCE(a.localRetailT2OpenValNext,0)-COALESCE(a.localRetailT1OpenVal,0)+COALESCE(a.localRetailT3OpenValNext,0)-COALESCE(a.localRetailT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'FOREIGN_RETAIL', 8, 'SUM(COALESCE(a.foreignRetailT2OpenVolNext,0)-COALESCE(a.foreignRetailT1OpenVol,0)+COALESCE(a.foreignRetailT3OpenVolNext,0)-COALESCE(a.foreignRetailT2OpenVol,0)), SUM(COALESCE(a.foreignRetailT2OpenValNext,0)-COALESCE(a.foreignRetailT1OpenVal,0)+COALESCE(a.foreignRetailT3OpenValNext,0)-COALESCE(a.foreignRetailT2OpenVal,0))', 'SUM(COALESCE(a.foreignRetailT2OpenValNext,0)-COALESCE(a.foreignRetailT1OpenVal,0)+COALESCE(a.foreignRetailT3OpenValNext,0)-COALESCE(a.foreignRetailT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'NOMINEES', 9, 'SUM(COALESCE(a.nomT2OpenVolNext,0)-COALESCE(a.nomT1OpenVol,0)+COALESCE(a.nomT3OpenVolNext,0)-COALESCE(a.nomT2OpenVol,0)), SUM(COALESCE(a.nomT2OpenValNext,0)-COALESCE(a.nomT1OpenVal,0)+COALESCE(a.nomT3OpenValNext,0)-COALESCE(a.nomT2OpenVal,0))', 'SUM(COALESCE(a.nomT2OpenValNext,0)-COALESCE(a.nomT1OpenVal,0)+COALESCE(a.nomT3OpenValNext,0)-COALESCE(a.nomT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'LOCAL_NOMINEES', 10, 'SUM(COALESCE(a.localNomT2OpenVolNext,0)-COALESCE(a.localNomT1OpenVol,0)+COALESCE(a.localNomT3OpenVolNext,0)-COALESCE(a.localNomT2OpenVol,0)), SUM(COALESCE(a.localNomT2OpenValNext,0)-COALESCE(a.localNomT1OpenVal,0)+COALESCE(a.localNomT3OpenValNext,0)-COALESCE(a.localNomT2OpenVal,0))', 'SUM(COALESCE(a.localNomT2OpenValNext,0)-COALESCE(a.localNomT1OpenVal,0)+COALESCE(a.localNomT3OpenValNext,0)-COALESCE(a.localNomT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'FOREIGN_NOMINEES', 11, 'SUM(COALESCE(a.foreignNomT2OpenVolNext,0)-COALESCE(a.foreignNomT1OpenVol,0)+COALESCE(a.foreignNomT3OpenVolNext,0)-COALESCE(a.foreignNomT2OpenVol,0)), SUM(COALESCE(a.foreignNomT2OpenValNext,0)-COALESCE(a.foreignNomT1OpenVal,0)+COALESCE(a.foreignNomT3OpenValNext,0)-COALESCE(a.foreignNomT2OpenVal,0))', 'SUM(COALESCE(a.foreignNomT2OpenValNext,0)-COALESCE(a.foreignNomT1OpenVal,0)+COALESCE(a.foreignNomT3OpenValNext,0)-COALESCE(a.foreignNomT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'PROPRIETARY', 12, 'sum(COALESCE(a.ivtT2OpenVolNext,0) + COALESCE(a.pdtT2OpenVolNext,0) - COALESCE(a.ivtT1OpenVol,0) - COALESCE(a.pdtT1OpenVol,0) + COALESCE(a.ivtT3OpenVolNext,0) + COALESCE(a.pdtT3OpenVolNext,0) - COALESCE(a.ivtT2OpenVol,0) - COALESCE(a.pdtT2OpenVol,0)), sum(COALESCE(a.ivtT2OpenValNext,0) + COALESCE(a.pdtT2OpenValNext,0) - COALESCE(a.ivtT1OpenVal,0) - COALESCE(a.pdtT1OpenVal,0) + COALESCE(a.ivtT3OpenValNext,0) + COALESCE(a.pdtT3OpenValNext,0) - COALESCE(a.ivtT2OpenVal,0) - COALESCE(a.pdtT2OpenVal,0))', 'sum(COALESCE(a.ivtT2OpenValNext,0) + COALESCE(a.pdtT2OpenValNext,0) - COALESCE(a.ivtT1OpenVal,0) - COALESCE(a.pdtT1OpenVal,0) + COALESCE(a.ivtT3OpenValNext,0) + COALESCE(a.pdtT3OpenValNext,0) - COALESCE(a.ivtT2OpenVal,0) - COALESCE(a.pdtT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'IVT', 13, 'SUM(COALESCE(a.ivtT2OpenVolNext,0)-COALESCE(a.ivtT1OpenVol,0)+COALESCE(a.ivtT3OpenVolNext,0)-COALESCE(a.ivtT2OpenVol,0)), SUM(COALESCE(a.ivtT2OpenValNext,0)-COALESCE(a.ivtT1OpenVal,0)+COALESCE(a.ivtT3OpenValNext,0)-COALESCE(a.ivtT2OpenVal,0))', 'SUM(COALESCE(a.ivtT2OpenValNext,0)-COALESCE(a.ivtT1OpenVal,0)+COALESCE(a.ivtT3OpenValNext,0)-COALESCE(a.ivtT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'PDT', 14, 'SUM(COALESCE(a.pdtT2OpenVolNext,0)-COALESCE(a.pdtT1OpenVol,0)+COALESCE(a.pdtT3OpenVolNext,0)-COALESCE(a.pdtT2OpenVol,0)), SUM(COALESCE(a.pdtT2OpenValNext,0)-COALESCE(a.pdtT1OpenVal,0)+COALESCE(a.pdtT3OpenValNext,0)-COALESCE(a.pdtT2OpenVal,0))', 'SUM(COALESCE(a.pdtT2OpenValNext,0)-COALESCE(a.pdtT1OpenVal,0)+COALESCE(a.pdtT3OpenValNext,0)-COALESCE(a.pdtT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'INST_NOMINEES', 15, 'SUM(COALESCE(a.instT2OpenVolNext,0) + COALESCE(a.nomT2OpenVolNext,0) - COALESCE(a.instT1OpenVol,0) - COALESCE(a.nomT1OpenVol,0) + COALESCE(a.instT3OpenVolNext,0) + COALESCE(a.nomT3OpenVolNext,0) - COALESCE(a.instT2OpenVol,0) - COALESCE(a.nomT2OpenVol,0)), sum(COALESCE(a.instT2OpenValNext,0) + COALESCE(a.nomT2OpenValNext,0) - COALESCE(a.instT1OpenVal,0) - COALESCE(a.nomT1OpenVal,0) + COALESCE(a.instT3OpenValNext,0) + COALESCE(a.nomT3OpenValNext,0) - COALESCE(a.instT2OpenVal,0) - COALESCE(a.nomT2OpenVal,0))', 'sum(COALESCE(a.instT2OpenValNext,0) + COALESCE(a.nomT2OpenValNext,0) - COALESCE(a.instT1OpenVal,0) - COALESCE(a.nomT1OpenVal,0) + COALESCE(a.instT3OpenValNext,0) + COALESCE(a.nomT3OpenValNext,0) - COALESCE(a.instT2OpenVal,0) - COALESCE(a.nomT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'LOCAL_INST_NOMINEES', 16, 'SUM(COALESCE(a.localInstT2OpenVolNext,0) + COALESCE(a.localNomT2OpenVolNext,0) - COALESCE(a.localInstT1OpenVol,0) - COALESCE(a.localNomT1OpenVol,0) + COALESCE(a.localInstT3OpenVolNext,0) + COALESCE(a.localNomT3OpenVolNext,0) - COALESCE(a.localInstT2OpenVol,0) - COALESCE(a.localNomT2OpenVol,0)), sum(COALESCE(a.localInstT2OpenValNext,0) + COALESCE(a.localNomT2OpenValNext,0) - COALESCE(a.localInstT1OpenVal,0) - COALESCE(a.localNomT1OpenVal,0) + COALESCE(a.localInstT3OpenValNext,0) + COALESCE(a.localNomT3OpenValNext,0) - COALESCE(a.localInstT2OpenVal,0) - COALESCE(a.localNomT2OpenVal,0))', 'sum(COALESCE(a.localInstT2OpenValNext,0) + COALESCE(a.localNomT2OpenValNext,0) - COALESCE(a.localInstT1OpenVal,0) - COALESCE(a.localNomT1OpenVal,0) + COALESCE(a.localInstT3OpenValNext,0) + COALESCE(a.localNomT3OpenValNext,0) - COALESCE(a.localInstT2OpenVal,0) - COALESCE(a.localNomT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'FOREIGN_INST_NOMINEES', 17, 'SUM(COALESCE(a.foreignInstT2OpenVolNext,0) + COALESCE(a.foreignNomT2OpenVolNext,0) - COALESCE(a.foreignInstT1OpenVol,0) - COALESCE(a.foreignNomT1OpenVol,0) + COALESCE(a.foreignInstT3OpenVolNext,0) + COALESCE(a.foreignNomT3OpenVolNext,0) - COALESCE(a.foreignInstT2OpenVol,0) - COALESCE(a.foreignNomT2OpenVol,0)), SUM(COALESCE(a.foreignInstT2OpenValNext,0) + COALESCE(a.foreignNomT2OpenValNext,0) - COALESCE(a.foreignInstT1OpenVal,0) - COALESCE(a.foreignNomT1OpenVal,0) + COALESCE(a.foreignInstT3OpenValNext,0) + COALESCE(a.foreignNomT3OpenValNext,0) - COALESCE(a.foreignInstT2OpenVal,0) - COALESCE(a.foreignNomT2OpenVal,0))', 'SUM(COALESCE(a.foreignInstT2OpenValNext,0) + COALESCE(a.foreignNomT2OpenValNext,0) - COALESCE(a.foreignInstT1OpenVal,0) - COALESCE(a.foreignNomT1OpenVal,0) + COALESCE(a.foreignInstT3OpenValNext,0) + COALESCE(a.foreignNomT3OpenValNext,0) - COALESCE(a.foreignInstT2OpenVal,0) - COALESCE(a.foreignNomT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'RETAIL_NOMINEES', 18, 'SUM(COALESCE(a.retailT2OpenVolNext,0) + COALESCE(a.nomT2OpenVolNext,0) - COALESCE(a.retailT1OpenVol,0) - COALESCE(a.nomT1OpenVol,0) + COALESCE(a.retailT3OpenVolNext,0) + COALESCE(a.nomT3OpenVolNext,0) - COALESCE(a.retailT2OpenVol,0) - COALESCE(a.nomT2OpenVol,0)), SUM(COALESCE(a.retailT2OpenValNext,0) + COALESCE(a.nomT2OpenValNext,0) - COALESCE(a.retailT1OpenVal,0) - COALESCE(a.nomT1OpenVal,0) + COALESCE(a.retailT3OpenValNext,0) + COALESCE(a.nomT3OpenValNext,0) - COALESCE(a.retailT2OpenVal,0) - COALESCE(a.nomT2OpenVal,0))', 'SUM(COALESCE(a.retailT2OpenValNext,0) + COALESCE(a.nomT2OpenValNext,0) - COALESCE(a.retailT1OpenVal,0) - COALESCE(a.nomT1OpenVal,0) + COALESCE(a.retailT3OpenValNext,0) + COALESCE(a.nomT3OpenValNext,0) - COALESCE(a.retailT2OpenVal,0) - COALESCE(a.nomT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'LOCAL_RETAIL_NOMINEES', 19, 'SUM(COALESCE(a.localRetailT2OpenVolNext,0) + COALESCE(a.localNomT2OpenVolNext,0) - COALESCE(a.localRetailT1OpenVol,0) - COALESCE(a.localNomT1OpenVol,0) + COALESCE(a.localRetailT3OpenVolNext,0) + COALESCE(a.localNomT3OpenVolNext,0) - COALESCE(a.localRetailT2OpenVol,0) - COALESCE(a.localNomT2OpenVol,0)), SUM(COALESCE(a.localRetailT2OpenValNext,0) + COALESCE(a.localNomT2OpenValNext,0) - COALESCE(a.localRetailT1OpenVal,0) - COALESCE(a.localNomT1OpenVal,0) + COALESCE(a.localRetailT3OpenValNext,0) + COALESCE(a.localNomT3OpenValNext,0) - COALESCE(a.localRetailT2OpenVal,0) - COALESCE(a.localNomT2OpenVal,0))', 'SUM(COALESCE(a.localRetailT2OpenValNext,0) + COALESCE(a.localNomT2OpenValNext,0) - COALESCE(a.localRetailT1OpenVal,0) - COALESCE(a.localNomT1OpenVal,0) + COALESCE(a.localRetailT3OpenValNext,0) + COALESCE(a.localNomT3OpenValNext,0) - COALESCE(a.localRetailT2OpenVal,0) - COALESCE(a.localNomT2OpenVal,0)) ASC'),
('marketContraVal', 9, 'FOREIGN_RETAIL_NOMINEES', 20, 'SUM(COALESCE(a.foreignRetailT2OpenVolNext,0) + COALESCE(a.foreignNomT2OpenVolNext,0) - COALESCE(a.foreignRetailT1OpenVol,0) - COALESCE(a.foreignNomT1OpenVol,0) + COALESCE(a.foreignRetailT3OpenVolNext,0) + COALESCE(a.foreignNomT3OpenVolNext,0) - COALESCE(a.foreignRetailT2OpenVol,0) - COALESCE(a.foreignNomT2OpenVol,0)), SUM(COALESCE(a.foreignRetailT2OpenValNext,0) + COALESCE(a.foreignNomT2OpenValNext,0) - COALESCE(a.foreignRetailT1OpenVal,0) - COALESCE(a.foreignNomT1OpenVal,0) + COALESCE(a.foreignRetailT3OpenValNext,0) + COALESCE(a.foreignNomT3OpenValNext,0) - COALESCE(a.foreignRetailT2OpenVal,0) - COALESCE(a.foreignNomT2OpenVal,0))', 'sum(COALESCE(a.foreignRetailT2OpenValNext,0) + COALESCE(a.foreignNomT2OpenValNext,0) - COALESCE(a.foreignRetailT1OpenVal,0) - COALESCE(a.foreignNomT1OpenVal,0) + COALESCE(a.foreignRetailT3OpenValNext,0) + COALESCE(a.foreignNomT3OpenValNext,0) - COALESCE(a.foreignRetailT2OpenVal,0) - COALESCE(a.foreignNomT2OpenVal,0)) ASC');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES
('marketContraVol', 10, 'ALL', 0, 'SUM(COALESCE(a.t2OpenVolNext,0)-COALESCE(a.t1OpenVol,0)+COALESCE(a.t3OpenVolNext,0)-COALESCE(a.t2OpenVol,0)), SUM(COALESCE(a.t2OpenVolNext,0)-COALESCE(a.t1OpenVol,0)+COALESCE(a.t3OpenVolNext,0)-COALESCE(a.t2OpenVol,0))', 'SUM(COALESCE(a.t2OpenVolNext,0)-COALESCE(a.t1OpenVol,0)+COALESCE(a.t3OpenVolNext,0)-COALESCE(a.t2OpenVol,0)) ASC'),
('marketContraVol', 10, 'LOCAL', 1, 'SUM(COALESCE(a.localT2OpenVolNext,0)-COALESCE(a.localT1OpenVol,0)+COALESCE(a.localT3OpenVolNext,0)-COALESCE(a.localT2OpenVol,0)), SUM(COALESCE(a.localT2OpenVolNext,0)-COALESCE(a.localT1OpenVol,0)+COALESCE(a.localT3OpenVolNext,0)-COALESCE(a.localT2OpenVol,0))', 'SUM(COALESCE(a.localT2OpenVolNext,0)-COALESCE(a.localT1OpenVol,0)+COALESCE(a.localT3OpenVolNext,0)-COALESCE(a.localT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'FOREIGN', 2, 'SUM(COALESCE(a.foreignT2OpenVolNext,0)-COALESCE(a.foreignT1OpenVol,0)+COALESCE(a.foreignT3OpenVolNext,0)-COALESCE(a.foreignT2OpenVol,0)), SUM(COALESCE(a.foreignT2OpenVolNext,0)-COALESCE(a.foreignT1OpenVol,0)+COALESCE(a.foreignT3OpenVolNext,0)-COALESCE(a.foreignT2OpenVol,0))', 'SUM(COALESCE(a.foreignT2OpenVolNext,0)-COALESCE(a.foreignT1OpenVol,0)+COALESCE(a.foreignT3OpenVolNext,0)-COALESCE(a.foreignT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'INST', 3, 'SUM(COALESCE(a.instT2OpenVolNext,0)-COALESCE(a.instT1OpenVol,0)+COALESCE(a.instT3OpenVolNext,0)-COALESCE(a.instT2OpenVol,0)), SUM(COALESCE(a.instT2OpenVolNext,0)-COALESCE(a.instT1OpenVol,0)+COALESCE(a.instT3OpenVolNext,0)-COALESCE(a.instT2OpenVol,0))', 'SUM(COALESCE(a.instT2OpenVolNext,0)-COALESCE(a.instT1OpenVol,0)+COALESCE(a.instT3OpenVolNext,0)-COALESCE(a.instT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'LOCAL_INST', 4, 'SUM(COALESCE(a.localInstT2OpenVolNext,0)-COALESCE(a.localInstT1OpenVol,0)+COALESCE(a.localInstT3OpenVolNext,0)-COALESCE(a.localInstT2OpenVol,0)), SUM(COALESCE(a.localInstT2OpenVolNext,0)-COALESCE(a.localInstT1OpenVol,0)+COALESCE(a.localInstT3OpenVolNext,0)-COALESCE(a.localInstT2OpenVol,0))', 'SUM(COALESCE(a.localInstT2OpenVolNext,0)-COALESCE(a.localInstT1OpenVol,0)+COALESCE(a.localInstT3OpenVolNext,0)-COALESCE(a.localInstT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'FOREIGN_INST', 5, 'SUM(COALESCE(a.foreignInstT2OpenVolNext,0)-COALESCE(a.foreignInstT1OpenVol,0)+COALESCE(a.foreignInstT3OpenVolNext,0)-COALESCE(a.foreignInstT2OpenVol,0)), SUM(COALESCE(a.foreignInstT2OpenVolNext,0)-COALESCE(a.foreignInstT1OpenVol,0)+COALESCE(a.foreignInstT3OpenVolNext,0)-COALESCE(a.foreignInstT2OpenVol,0))', 'SUM(COALESCE(a.foreignInstT2OpenVolNext,0)-COALESCE(a.foreignInstT1OpenVol,0)+COALESCE(a.foreignInstT3OpenVolNext,0)-COALESCE(a.foreignInstT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'RETAIL', 6, 'SUM(COALESCE(a.retailT2OpenVolNext,0)-COALESCE(a.retailT1OpenVol,0)+COALESCE(a.retailT3OpenVolNext,0)-COALESCE(a.retailT2OpenVol,0)), SUM(COALESCE(a.retailT2OpenVolNext,0)-COALESCE(a.retailT1OpenVol,0)+COALESCE(a.retailT3OpenVolNext,0)-COALESCE(a.retailT2OpenVol,0))', 'SUM(COALESCE(a.retailT2OpenVolNext,0)-COALESCE(a.retailT1OpenVol,0)+COALESCE(a.retailT3OpenVolNext,0)-COALESCE(a.retailT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'LOCAL_RETAIL', 7, 'SUM(COALESCE(a.localRetailT2OpenVolNext,0)-COALESCE(a.localRetailT1OpenVol,0)+COALESCE(a.localRetailT3OpenVolNext,0)-COALESCE(a.localRetailT2OpenVol,0)), SUM(COALESCE(a.localRetailT2OpenVolNext,0)-COALESCE(a.localRetailT1OpenVol,0)+COALESCE(a.localRetailT3OpenVolNext,0)-COALESCE(a.localRetailT2OpenVol,0))', 'SUM(COALESCE(a.localRetailT2OpenVolNext,0)-COALESCE(a.localRetailT1OpenVol,0)+COALESCE(a.localRetailT3OpenVolNext,0)-COALESCE(a.localRetailT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'FOREIGN_RETAIL', 8, 'SUM(COALESCE(a.foreignRetailT2OpenVolNext,0)-COALESCE(a.foreignRetailT1OpenVol,0)+COALESCE(a.foreignRetailT3OpenVolNext,0)-COALESCE(a.foreignRetailT2OpenVol,0)), SUM(COALESCE(a.foreignRetailT2OpenVolNext,0)-COALESCE(a.foreignRetailT1OpenVol,0)+COALESCE(a.foreignRetailT3OpenVolNext,0)-COALESCE(a.foreignRetailT2OpenVol,0))', 'SUM(COALESCE(a.foreignRetailT2OpenVolNext,0)-COALESCE(a.foreignRetailT1OpenVol,0)+COALESCE(a.foreignRetailT3OpenVolNext,0)-COALESCE(a.foreignRetailT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'NOMINEES', 9, 'SUM(COALESCE(a.nomT2OpenVolNext,0)-COALESCE(a.nomT1OpenVol,0)+COALESCE(a.nomT3OpenVolNext,0)-COALESCE(a.nomT2OpenVol,0)), SUM(COALESCE(a.nomT2OpenVolNext,0)-COALESCE(a.nomT1OpenVol,0)+COALESCE(a.nomT3OpenVolNext,0)-COALESCE(a.nomT2OpenVol,0))', 'SUM(COALESCE(a.nomT2OpenVolNext,0)-COALESCE(a.nomT1OpenVol,0)+COALESCE(a.nomT3OpenVolNext,0)-COALESCE(a.nomT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'LOCAL_NOMINEES', 10, 'SUM(COALESCE(a.localNomT2OpenVolNext,0)-COALESCE(a.localNomT1OpenVol,0)+COALESCE(a.localNomT3OpenVolNext,0)-COALESCE(a.localNomT2OpenVol,0)), SUM(COALESCE(a.localNomT2OpenVolNext,0)-COALESCE(a.localNomT1OpenVol,0)+COALESCE(a.localNomT3OpenVolNext,0)-COALESCE(a.localNomT2OpenVol,0))', 'SUM(COALESCE(a.localNomT2OpenVolNext,0)-COALESCE(a.localNomT1OpenVol,0)+COALESCE(a.localNomT3OpenVolNext,0)-COALESCE(a.localNomT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'FOREIGN_NOMINEES', 11, 'SUM(COALESCE(a.foreignNomT2OpenVolNext,0)-COALESCE(a.foreignNomT1OpenVol,0)+COALESCE(a.foreignNomT3OpenVolNext,0)-COALESCE(a.foreignNomT2OpenVol,0)), SUM(COALESCE(a.foreignNomT2OpenVolNext,0)-COALESCE(a.foreignNomT1OpenVol,0)+COALESCE(a.foreignNomT3OpenVolNext,0)-COALESCE(a.foreignNomT2OpenVol,0))', 'SUM(COALESCE(a.foreignNomT2OpenVolNext,0)-COALESCE(a.foreignNomT1OpenVol,0)+COALESCE(a.foreignNomT3OpenVolNext,0)-COALESCE(a.foreignNomT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'PROPRIETARY', 12, 'sum(COALESCE(a.ivtT2OpenVolNext,0) + COALESCE(a.pdtT2OpenVolNext,0) - COALESCE(a.ivtT1OpenVol,0) - COALESCE(a.pdtT1OpenVol,0) + COALESCE(a.ivtT3OpenVolNext,0) + COALESCE(a.pdtT3OpenVolNext,0) - COALESCE(a.ivtT2OpenVol,0) - COALESCE(a.pdtT2OpenVol,0)), sum(COALESCE(a.ivtT2OpenVolNext,0) + COALESCE(a.pdtT2OpenVolNext,0) - COALESCE(a.ivtT1OpenVol,0) - COALESCE(a.pdtT1OpenVol,0) + COALESCE(a.ivtT3OpenVolNext,0) + COALESCE(a.pdtT3OpenVolNext,0) - COALESCE(a.ivtT2OpenVol,0) - COALESCE(a.pdtT2OpenVol,0))', 'sum(COALESCE(a.ivtT2OpenVolNext,0) + COALESCE(a.pdtT2OpenVolNext,0) - COALESCE(a.ivtT1OpenVol,0) - COALESCE(a.pdtT1OpenVol,0) + COALESCE(a.ivtT3OpenVolNext,0) + COALESCE(a.pdtT3OpenVolNext,0) - COALESCE(a.ivtT2OpenVol,0) - COALESCE(a.pdtT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'IVT', 13, 'SUM(COALESCE(a.ivtT2OpenVolNext,0)-COALESCE(a.ivtT1OpenVol,0)+COALESCE(a.ivtT3OpenVolNext,0)-COALESCE(a.ivtT2OpenVol,0)), SUM(COALESCE(a.ivtT2OpenVolNext,0)-COALESCE(a.ivtT1OpenVol,0)+COALESCE(a.ivtT3OpenVolNext,0)-COALESCE(a.ivtT2OpenVol,0))', 'SUM(COALESCE(a.ivtT2OpenVolNext,0)-COALESCE(a.ivtT1OpenVol,0)+COALESCE(a.ivtT3OpenVolNext,0)-COALESCE(a.ivtT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'PDT', 14, 'SUM(COALESCE(a.pdtT2OpenVolNext,0)-COALESCE(a.pdtT1OpenVol,0)+COALESCE(a.pdtT3OpenVolNext,0)-COALESCE(a.pdtT2OpenVol,0)), SUM(COALESCE(a.pdtT2OpenVolNext,0)-COALESCE(a.pdtT1OpenVol,0)+COALESCE(a.pdtT3OpenVolNext,0)-COALESCE(a.pdtT2OpenVol,0))', 'SUM(COALESCE(a.pdtT2OpenVolNext,0)-COALESCE(a.pdtT1OpenVol,0)+COALESCE(a.pdtT3OpenVolNext,0)-COALESCE(a.pdtT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'INST_NOMINEES', 15, 'SUM(COALESCE(a.instT2OpenVolNext,0) + COALESCE(a.nomT2OpenVolNext,0) - COALESCE(a.instT1OpenVol,0) - COALESCE(a.nomT1OpenVol,0) + COALESCE(a.instT3OpenVolNext,0) + COALESCE(a.nomT3OpenVolNext,0) - COALESCE(a.instT2OpenVol,0) - COALESCE(a.nomT2OpenVol,0)), sum(COALESCE(a.instT2OpenVolNext,0) + COALESCE(a.nomT2OpenVolNext,0) - COALESCE(a.instT1OpenVol,0) - COALESCE(a.nomT1OpenVol,0) + COALESCE(a.instT3OpenVolNext,0) + COALESCE(a.nomT3OpenVolNext,0) - COALESCE(a.instT2OpenVol,0) - COALESCE(a.nomT2OpenVol,0))', 'sum(COALESCE(a.instT2OpenVolNext,0) + COALESCE(a.nomT2OpenVolNext,0) - COALESCE(a.instT1OpenVol,0) - COALESCE(a.nomT1OpenVol,0) + COALESCE(a.instT3OpenVolNext,0) + COALESCE(a.nomT3OpenVolNext,0) - COALESCE(a.instT2OpenVol,0) - COALESCE(a.nomT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'LOCAL_INST_NOMINEES', 16, 'SUM(COALESCE(a.localInstT2OpenVolNext,0) + COALESCE(a.localNomT2OpenVolNext,0) - COALESCE(a.localInstT1OpenVol,0) - COALESCE(a.localNomT1OpenVol,0) + COALESCE(a.localInstT3OpenVolNext,0) + COALESCE(a.localNomT3OpenVolNext,0) - COALESCE(a.localInstT2OpenVol,0) - COALESCE(a.localNomT2OpenVol,0)), sum(COALESCE(a.localInstT2OpenVolNext,0) + COALESCE(a.localNomT2OpenVolNext,0) - COALESCE(a.localInstT1OpenVol,0) - COALESCE(a.localNomT1OpenVol,0) + COALESCE(a.localInstT3OpenVolNext,0) + COALESCE(a.localNomT3OpenVolNext,0) - COALESCE(a.localInstT2OpenVol,0) - COALESCE(a.localNomT2OpenVol,0))', 'sum(COALESCE(a.localInstT2OpenVolNext,0) + COALESCE(a.localNomT2OpenVolNext,0) - COALESCE(a.localInstT1OpenVol,0) - COALESCE(a.localNomT1OpenVol,0) + COALESCE(a.localInstT3OpenVolNext,0) + COALESCE(a.localNomT3OpenVolNext,0) - COALESCE(a.localInstT2OpenVol,0) - COALESCE(a.localNomT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'FOREIGN_INST_NOMINEES', 17, 'SUM(COALESCE(a.foreignInstT2OpenVolNext,0) + COALESCE(a.foreignNomT2OpenVolNext,0) - COALESCE(a.foreignInstT1OpenVol,0) - COALESCE(a.foreignNomT1OpenVol,0) + COALESCE(a.foreignInstT3OpenVolNext,0) + COALESCE(a.foreignNomT3OpenVolNext,0) - COALESCE(a.foreignInstT2OpenVol,0) - COALESCE(a.foreignNomT2OpenVol,0)), SUM(COALESCE(a.foreignInstT2OpenVolNext,0) + COALESCE(a.foreignNomT2OpenVolNext,0) - COALESCE(a.foreignInstT1OpenVol,0) - COALESCE(a.foreignNomT1OpenVol,0) + COALESCE(a.foreignInstT3OpenVolNext,0) + COALESCE(a.foreignNomT3OpenVolNext,0) - COALESCE(a.foreignInstT2OpenVol,0) - COALESCE(a.foreignNomT2OpenVol,0))', 'SUM(COALESCE(a.foreignInstT2OpenVolNext,0) + COALESCE(a.foreignNomT2OpenVolNext,0) - COALESCE(a.foreignInstT1OpenVol,0) - COALESCE(a.foreignNomT1OpenVol,0) + COALESCE(a.foreignInstT3OpenVolNext,0) + COALESCE(a.foreignNomT3OpenVolNext,0) - COALESCE(a.foreignInstT2OpenVol,0) - COALESCE(a.foreignNomT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'RETAIL_NOMINEES', 18, 'SUM(COALESCE(a.retailT2OpenVolNext,0) + COALESCE(a.nomT2OpenVolNext,0) - COALESCE(a.retailT1OpenVol,0) - COALESCE(a.nomT1OpenVol,0) + COALESCE(a.retailT3OpenVolNext,0) + COALESCE(a.nomT3OpenVolNext,0) - COALESCE(a.retailT2OpenVol,0) - COALESCE(a.nomT2OpenVol,0)), SUM(COALESCE(a.retailT2OpenVolNext,0) + COALESCE(a.nomT2OpenVolNext,0) - COALESCE(a.retailT1OpenVol,0) - COALESCE(a.nomT1OpenVol,0) + COALESCE(a.retailT3OpenVolNext,0) + COALESCE(a.nomT3OpenVolNext,0) - COALESCE(a.retailT2OpenVol,0) - COALESCE(a.nomT2OpenVol,0))', 'SUM(COALESCE(a.retailT2OpenVolNext,0) + COALESCE(a.nomT2OpenVolNext,0) - COALESCE(a.retailT1OpenVol,0) - COALESCE(a.nomT1OpenVol,0) + COALESCE(a.retailT3OpenVolNext,0) + COALESCE(a.nomT3OpenVolNext,0) - COALESCE(a.retailT2OpenVol,0) - COALESCE(a.nomT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'LOCAL_RETAIL_NOMINEES', 19, 'SUM(COALESCE(a.localRetailT2OpenVolNext,0) + COALESCE(a.localNomT2OpenVolNext,0) - COALESCE(a.localRetailT1OpenVol,0) - COALESCE(a.localNomT1OpenVol,0) + COALESCE(a.localRetailT3OpenVolNext,0) + COALESCE(a.localNomT3OpenVolNext,0) - COALESCE(a.localRetailT2OpenVol,0) - COALESCE(a.localNomT2OpenVol,0)), SUM(COALESCE(a.localRetailT2OpenVolNext,0) + COALESCE(a.localNomT2OpenVolNext,0) - COALESCE(a.localRetailT1OpenVol,0) - COALESCE(a.localNomT1OpenVol,0) + COALESCE(a.localRetailT3OpenVolNext,0) + COALESCE(a.localNomT3OpenVolNext,0) - COALESCE(a.localRetailT2OpenVol,0) - COALESCE(a.localNomT2OpenVol,0))', 'SUM(COALESCE(a.localRetailT2OpenVolNext,0) + COALESCE(a.localNomT2OpenVolNext,0) - COALESCE(a.localRetailT1OpenVol,0) - COALESCE(a.localNomT1OpenVol,0) + COALESCE(a.localRetailT3OpenVolNext,0) + COALESCE(a.localNomT3OpenVolNext,0) - COALESCE(a.localRetailT2OpenVol,0) - COALESCE(a.localNomT2OpenVol,0)) ASC'),
('marketContraVol', 10, 'FOREIGN_RETAIL_NOMINEES', 20, 'SUM(COALESCE(a.foreignRetailT2OpenVolNext,0) + COALESCE(a.foreignNomT2OpenVolNext,0) - COALESCE(a.foreignRetailT1OpenVol,0) - COALESCE(a.foreignNomT1OpenVol,0) + COALESCE(a.foreignRetailT3OpenVolNext,0) + COALESCE(a.foreignNomT3OpenVolNext,0) - COALESCE(a.foreignRetailT2OpenVol,0) - COALESCE(a.foreignNomT2OpenVol,0)), SUM(COALESCE(a.foreignRetailT2OpenVolNext,0) + COALESCE(a.foreignNomT2OpenVolNext,0) - COALESCE(a.foreignRetailT1OpenVol,0) - COALESCE(a.foreignNomT1OpenVol,0) + COALESCE(a.foreignRetailT3OpenVolNext,0) + COALESCE(a.foreignNomT3OpenVolNext,0) - COALESCE(a.foreignRetailT2OpenVol,0) - COALESCE(a.foreignNomT2OpenVol,0))', 'sum(COALESCE(a.foreignRetailT2OpenVolNext,0) + COALESCE(a.foreignNomT2OpenVolNext,0) - COALESCE(a.foreignRetailT1OpenVol,0) - COALESCE(a.foreignNomT1OpenVol,0) + COALESCE(a.foreignRetailT3OpenVolNext,0) + COALESCE(a.foreignNomT3OpenVolNext,0) - COALESCE(a.foreignRetailT2OpenVol,0) - COALESCE(a.foreignNomT2OpenVol,0)) ASC');


insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag)
VALUES
('marketContraGraph', 11, 'ALL', 0, 'sum(COALESCE(a.t2OpenVolNext,0) - COALESCE(a.t1OpenVol,0) + COALESCE(a.t3OpenVolNext,0) - COALESCE(a.t2OpenVol,0)), sum(COALESCE(a.t2OpenValNext,0) - COALESCE(a.t1OpenVal,0) + COALESCE(a.t3OpenValNext,0) - COALESCE(a.t2OpenVal,0))'),
('marketContraGraph', 11, 'LOCAL', 1, 'sum(COALESCE(a.localT2OpenVolNext,0) - COALESCE(a.localT1OpenVol,0) + COALESCE(a.localT3OpenVolNext,0) - COALESCE(a.localT2OpenVol,0)), sum(COALESCE(a.localT2OpenValNext,0) - COALESCE(a.localT1OpenVal,0) + COALESCE(a.localT3OpenValNext,0) - COALESCE(a.localT2OpenVal,0))'),
('marketContraGraph', 11, 'FOREIGN', 2, 'sum(COALESCE(a.foreignT2OpenVolNext,0) - COALESCE(a.foreignT1OpenVol,0) + COALESCE(a.foreignT3OpenVolNext,0) - COALESCE(a.foreignT2OpenVol,0)), sum(COALESCE(a.foreignT2OpenValNext,0) - COALESCE(a.foreignT1OpenVal,0) + COALESCE(a.foreignT3OpenValNext,0) - COALESCE(a.foreignT2OpenVal,0))'),
('marketContraGraph', 11, 'INST', 3, 'sum(COALESCE(a.instT2OpenVolNext,0) - COALESCE(a.instT1OpenVol,0) + COALESCE(a.instT3OpenVolNext,0) - COALESCE(a.instT2OpenVol,0)), sum(COALESCE(a.instT2OpenValNext,0) - COALESCE(a.instT1OpenVal,0) + COALESCE(a.instT3OpenValNext,0) - COALESCE(a.instT2OpenVal,0))'),
('marketContraGraph', 11, 'LOCAL_INST', 4, 'sum(COALESCE(a.localInstT2OpenVolNext,0) - COALESCE(a.localInstT1OpenVol,0) + COALESCE(a.localInstT3OpenVolNext,0) - COALESCE(a.localInstT2OpenVol,0)), sum(COALESCE(a.localInstT2OpenValNext,0) - COALESCE(a.localInstT1OpenVal,0) + COALESCE(a.localInstT3OpenValNext,0) - COALESCE(a.localInstT2OpenVal,0))'),
('marketContraGraph', 11, 'FOREIGN_INST', 5, 'sum(COALESCE(a.foreignInstT2OpenVolNext,0) - COALESCE(a.foreignInstT1OpenVol,0) + COALESCE(a.foreignInstT3OpenVolNext,0) - COALESCE(a.foreignInstT2OpenVol,0)), sum(COALESCE(a.foreignInstT2OpenValNext,0) - COALESCE(a.foreignInstT1OpenVal,0) + COALESCE(a.foreignInstT3OpenValNext,0) - COALESCE(a.foreignInstT2OpenVal,0))'),
('marketContraGraph', 11, 'RETAIL', 6, 'sum(COALESCE(a.retailT2OpenVolNext,0) - COALESCE(a.retailT1OpenVol,0) + COALESCE(a.retailT3OpenVolNext,0) - COALESCE(a.retailT2OpenVol,0)), sum(COALESCE(a.retailT2OpenValNext,0) - COALESCE(a.retailT1OpenVal,0) + COALESCE(a.retailT3OpenValNext,0) - COALESCE(a.retailT2OpenVal,0))'),
('marketContraGraph', 11, 'LOCAL_RETAIL', 7, 'sum(COALESCE(a.localRetailT2OpenVolNext,0) - COALESCE(a.localRetailT1OpenVol,0) + COALESCE(a.localRetailT3OpenVolNext,0) - COALESCE(a.localRetailT2OpenVol,0)), sum(COALESCE(a.localRetailT2OpenValNext,0) - COALESCE(a.localRetailT1OpenVal,0) + COALESCE(a.localRetailT3OpenValNext,0) - COALESCE(a.localRetailT2OpenVal,0))'),
('marketContraGraph', 11, 'FOREIGN_RETAIL', 8, 'sum(COALESCE(a.foreignRetailT2OpenVolNext,0) - COALESCE(a.foreignRetailT1OpenVol,0) + COALESCE(a.foreignRetailT3OpenVolNext,0) - COALESCE(a.foreignRetailT2OpenVol,0)), sum(COALESCE(a.foreignRetailT2OpenValNext,0) - COALESCE(a.foreignRetailT1OpenVal,0) + COALESCE(a.foreignRetailT3OpenValNext,0) - COALESCE(a.foreignRetailT2OpenVal,0))'),
('marketContraGraph', 11, 'NOMINEES', 9, 'sum(COALESCE(a.nomT2OpenVolNext,0) - COALESCE(a.nomT1OpenVol,0) + COALESCE(a.nomT3OpenVolNext,0) - COALESCE(a.nomT2OpenVol,0)), sum(COALESCE(a.nomT2OpenValNext,0) - COALESCE(a.nomT1OpenVal,0) + COALESCE(a.nomT3OpenValNext,0) - COALESCE(a.nomT2OpenVal,0))'),
('marketContraGraph', 11, 'LOCAL_NOMINEES', 10, 'sum(COALESCE(a.localNomT2OpenVolNext,0) - COALESCE(a.localNomT1OpenVol,0) + COALESCE(a.localNomT3OpenVolNext,0) - COALESCE(a.localNomT2OpenVol,0)), sum(COALESCE(a.localNomT2OpenValNext,0) - COALESCE(a.localNomT1OpenVal,0) + COALESCE(a.localNomT3OpenValNext,0) - COALESCE(a.localNomT2OpenVal,0))'),
('marketContraGraph', 11, 'FOREIGN_NOMINEES', 11, 'sum(COALESCE(a.foreignNomT2OpenVolNext,0) - COALESCE(a.foreignNomT1OpenVol,0) + COALESCE(a.foreignNomT3OpenVolNext,0) - COALESCE(a.foreignNomT2OpenVol,0)), sum(COALESCE(a.foreignNomT2OpenValNext,0) - COALESCE(a.foreignNomT1OpenVal,0) + COALESCE(a.foreignNomT3OpenValNext,0) - COALESCE(a.foreignNomT2OpenVal,0))'),
('marketContraGraph', 11, 'PROPRIETARY', 12, 'sum(COALESCE(a.ivtT2OpenVolNext,0) + COALESCE(a.pdtT2OpenVolNext,0) - COALESCE(a.ivtT1OpenVol,0) - COALESCE(a.pdtT1OpenVol,0) + COALESCE(a.ivtT3OpenVolNext,0) + COALESCE(a.pdtT3OpenVolNext,0) - COALESCE(a.ivtT2OpenVol,0) - COALESCE(a.pdtT2OpenVol,0)), sum(COALESCE(a.ivtT2OpenValNext,0) + COALESCE(a.pdtT2OpenValNext,0) - COALESCE(a.ivtT1OpenVal,0) - COALESCE(a.pdtT1OpenVal,0) + COALESCE(a.ivtT3OpenValNext,0) + COALESCE(a.pdtT3OpenValNext,0) - COALESCE(a.ivtT2OpenVal,0) - COALESCE(a.pdtT2OpenVal,0))'),
('marketContraGraph', 11, 'IVT', 13, 'sum(COALESCE(a.ivtT2OpenVolNext,0) - COALESCE(a.ivtT1OpenVol,0) + COALESCE(a.ivtT3OpenVolNext,0) - COALESCE(a.ivtT2OpenVol,0)), sum(COALESCE(a.ivtT2OpenValNext,0) - COALESCE(a.ivtT1OpenVal,0) + COALESCE(a.ivtT3OpenValNext,0) - COALESCE(a.ivtT2OpenVal,0))'),
('marketContraGraph', 11, 'PDT', 14, 'sum(COALESCE(a.pdtT2OpenVolNext,0) - COALESCE(a.pdtT1OpenVol,0) + COALESCE(a.pdtT3OpenVolNext,0) - COALESCE(a.pdtT2OpenVol,0)), sum(COALESCE(a.pdtT2OpenValNext,0) - COALESCE(a.pdtT1OpenVal,0) + COALESCE(a.pdtT3OpenValNext,0) - COALESCE(a.pdtT2OpenVal,0))'),
('marketContraGraph', 11, 'INST_NOMINEES', 15, 'sum(COALESCE(a.instT2OpenVolNext,0) + COALESCE(a.nomT2OpenVolNext,0) - COALESCE(a.instT1OpenVol,0) - COALESCE(a.nomT1OpenVol,0) + COALESCE(a.instT3OpenVolNext,0) + COALESCE(a.nomT3OpenVolNext,0) - COALESCE(a.instT2OpenVol,0) - COALESCE(a.nomT2OpenVol,0)), sum(COALESCE(a.instT2OpenValNext,0) + COALESCE(a.nomT2OpenValNext,0) - COALESCE(a.instT1OpenVal,0) - COALESCE(a.nomT1OpenVal,0) + COALESCE(a.instT3OpenValNext,0) + COALESCE(a.nomT3OpenValNext,0) - COALESCE(a.instT2OpenVal,0) - COALESCE(a.nomT2OpenVal,0))'),
('marketContraGraph', 11, 'LOCAL_INST_NOMINEES', 16, 'sum(COALESCE(a.localInstT2OpenVolNext,0) + COALESCE(a.localNomT2OpenVolNext,0) - COALESCE(a.localInstT1OpenVol,0) - COALESCE(a.localNomT1OpenVol,0) + COALESCE(a.localInstT3OpenVolNext,0) + COALESCE(a.localNomT3OpenVolNext,0) - COALESCE(a.localInstT2OpenVol,0) - COALESCE(a.localNomT2OpenVol,0)), sum(COALESCE(a.localInstT2OpenValNext,0) + COALESCE(a.localNomT2OpenValNext,0) - COALESCE(a.localInstT1OpenVal,0) - COALESCE(a.localNomT1OpenVal,0) + COALESCE(a.localInstT3OpenValNext,0) + COALESCE(a.localNomT3OpenValNext,0) - COALESCE(a.localInstT2OpenVal,0) - COALESCE(a.localNomT2OpenVal,0))'),
('marketContraGraph', 11, 'FOREIGN_INST_NOMINEES', 17, 'sum(COALESCE(a.foreignInstT2OpenVolNext,0) + COALESCE(a.foreignNomT2OpenVolNext,0) - COALESCE(a.foreignInstT1OpenVol,0) - COALESCE(a.foreignNomT1OpenVol,0) + COALESCE(a.foreignInstT3OpenVolNext,0) + COALESCE(a.foreignNomT3OpenVolNext,0) - COALESCE(a.foreignInstT2OpenVol,0) - COALESCE(a.foreignNomT2OpenVol,0)), sum(COALESCE(a.foreignInstT2OpenValNext,0) + COALESCE(a.foreignNomT2OpenValNext,0) - COALESCE(a.foreignInstT1OpenVal,0) - COALESCE(a.foreignNomT1OpenVal,0) + COALESCE(a.foreignInstT3OpenValNext,0) + COALESCE(a.foreignNomT3OpenValNext,0) - COALESCE(a.foreignInstT2OpenVal,0) - COALESCE(a.foreignNomT2OpenVal,0))'),
('marketContraGraph', 11, 'RETAIL_NOMINEES', 18, 'sum(COALESCE(a.retailT2OpenVolNext,0) + COALESCE(a.nomT2OpenVolNext,0) - COALESCE(a.retailT1OpenVol,0) - COALESCE(a.nomT1OpenVol,0) + COALESCE(a.retailT3OpenVolNext,0) + COALESCE(a.nomT3OpenVolNext,0) - COALESCE(a.retailT2OpenVol,0) - COALESCE(a.nomT2OpenVol,0)), sum(COALESCE(a.retailT2OpenValNext,0) + COALESCE(a.nomT2OpenValNext,0) - COALESCE(a.retailT1OpenVal,0) - COALESCE(a.nomT1OpenVal,0) + COALESCE(a.retailT3OpenValNext,0) + COALESCE(a.nomT3OpenValNext,0) - COALESCE(a.retailT2OpenVal,0) - COALESCE(a.nomT2OpenVal,0))'),
('marketContraGraph', 11, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(COALESCE(a.localRetailT2OpenVolNext,0) + COALESCE(a.localNomT2OpenVolNext,0) - COALESCE(a.localRetailT1OpenVol,0) - COALESCE(a.localNomT1OpenVol,0) + COALESCE(a.localRetailT3OpenVolNext,0) + COALESCE(a.localNomT3OpenVolNext,0) - COALESCE(a.localRetailT2OpenVol,0) - COALESCE(a.localNomT2OpenVol,0)), sum(COALESCE(a.localRetailT2OpenValNext,0) + COALESCE(a.localNomT2OpenValNext,0) - COALESCE(a.localRetailT1OpenVal,0) - COALESCE(a.localNomT1OpenVal,0) + COALESCE(a.localRetailT3OpenValNext,0) + COALESCE(a.localNomT3OpenValNext,0) - COALESCE(a.localRetailT2OpenVal,0) - COALESCE(a.localNomT2OpenVal,0))'),
('marketContraGraph', 11, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(COALESCE(a.foreignRetailT2OpenVolNext,0) + COALESCE(a.foreignNomT2OpenVolNext,0) - COALESCE(a.foreignRetailT1OpenVol,0) - COALESCE(a.foreignNomT1OpenVol,0) + COALESCE(a.foreignRetailT3OpenVolNext,0) + COALESCE(a.foreignNomT3OpenVolNext,0) - COALESCE(a.foreignRetailT2OpenVol,0) - COALESCE(a.foreignNomT2OpenVol,0)), sum(COALESCE(a.foreignRetailT2OpenValNext,0) + COALESCE(a.foreignNomT2OpenValNext,0) - COALESCE(a.foreignRetailT1OpenVal,0) - COALESCE(a.foreignNomT1OpenVal,0) + COALESCE(a.foreignRetailT3OpenValNext,0) + COALESCE(a.foreignNomT3OpenValNext,0) - COALESCE(a.foreignRetailT2OpenVal,0) - COALESCE(a.foreignNomT2OpenVal,0))');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag)
VALUES 
('marketDbtGraph', 12, 'ALL', 0, 'sum(a.totalVol), sum(a.totalVal)'),
('marketDbtGraph', 12, 'LOCAL', 1, 'sum(a.localVol), sum(a.localVal)'),
('marketDbtGraph', 12, 'FOREIGN', 2, 'sum(a.foreignVol), sum(a.foreignVal)'),
('marketDbtGraph', 12, 'INST', 3, 'sum(a.instVol), sum(a.instVal)'),
('marketDbtGraph', 12, 'LOCAL_INST', 4, 'sum(a.localInstVol), sum(a.localInstVal)'),
('marketDbtGraph', 12, 'FOREIGN_INST', 5, 'sum(a.foreignInstVol), sum(a.foreignInstVal)'),
('marketDbtGraph', 12, 'RETAIL', 6, 'sum(a.retailVol), sum(a.retailVal)'),
('marketDbtGraph', 12, 'LOCAL_RETAIL', 7, 'sum(a.localRetailVol), sum(a.localRetailVal)'),
('marketDbtGraph', 12, 'FOREIGN_RETAIL', 8, 'sum(a.foreignRetailVol), sum(a.foreignRetailVal)'),
('marketDbtGraph', 12, 'NOMINEES', 9, 'sum(a.nomineesVol), sum(a.nomineesVal)'),
('marketDbtGraph', 12, 'LOCAL_NOMINEES', 10, 'sum(a.localNomineesVol), sum(a.localNomineesVal)'),
('marketDbtGraph', 12, 'FOREIGN_NOMINEES', 11, 'sum(a.foreignNomineesVol), sum(a.foreignNomineesVal)'),
('marketDbtGraph', 12, 'PROPRIETARY', 12, 'sum(coalesce(a.ivtVol,0) + coalesce(a.pdtVol,0)), sum(coalesce(a.ivtVal,0) + coalesce(a.pdtVal,0))'),
('marketDbtGraph', 12, 'IVT', 13, 'sum(a.ivtVol), sum(a.ivtVal)'),
('marketDbtGraph', 12, 'PDT', 14, 'sum(a.pdtVol), sum(a.pdtVal)'),
('marketDbtGraph', 12, 'INST_NOMINEES', 15, 'sum(coalesce(a.instVol,0) + coalesce(a.nomineesVol,0)), sum(coalesce(a.instVal,0) + coalesce(a.nomineesVal,0))'),
('marketDbtGraph', 12, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.localInstVol,0) + coalesce(a.localNomineesVol,0)), sum(coalesce(a.localInstVal,0) + coalesce(a.localNomineesVal,0))'),
('marketDbtGraph', 12, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.foreignInstVol,0) + coalesce(a.foreignNomineesVol,0)), sum(coalesce(a.foreignInstVal,0) + coalesce(a.foreignNomineesVal,0))'),
('marketDbtGraph', 12, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.retailVol,0) + coalesce(a.nomineesVol,0)), sum(coalesce(a.retailVal,0) + coalesce(a.nomineesVal,0))'),
('marketDbtGraph', 12, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.localRetailVol,0) + coalesce(a.localNomineesVol,0)), sum(coalesce(a.localRetailVal,0) + coalesce(a.localNomineesVal,0))'),
('marketDbtGraph', 12, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.foreignRetailVol,0) + coalesce(a.foreignNomineesVol,0)), sum(coalesce(a.foreignRetailVal,0) + coalesce(a.foreignNomineesVal,0))');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES 
('brokerActiveVol', 13, 'ALL', 0, 'sum(a.totalVolume), sum(a.totalValue),', 'sum(coalesce(a.totalVolume,0)) DESC'),
('brokerActiveVol', 13, 'LOCAL', 1, 'sum(a.localVolume), sum(a.localValue),', 'sum(coalesce(a.localVolume,0)) DESC'),
('brokerActiveVol', 13, 'FOREIGN', 2, 'sum(a.foreignVolume), sum(a.foreignValue),', 'sum(coalesce(a.foreignVolume,0)) DESC'),
('brokerActiveVol', 13, 'INST', 3, 'sum(a.totalInstVolume), sum(a.totalInstValue),', 'sum(coalesce(a.totalInstVolume,0)) DESC'),
('brokerActiveVol', 13, 'LOCAL_INST', 4, 'sum(a.localInstVolume), sum(a.localInstValue),', 'sum(coalesce(a.localInstVolume,0)) DESC'),
('brokerActiveVol', 13, 'FOREIGN_INST', 5, 'sum(a.foreignInstVolume), sum(a.foreignInstValue),', 'sum(coalesce(a.foreignInstVolume,0)) DESC'),
('brokerActiveVol', 13, 'RETAIL', 6, 'sum(a.totalRetailVolume), sum(a.totalRetailValue),', 'sum(coalesce(a.totalRetailVolume,0)) DESC'),
('brokerActiveVol', 13, 'LOCAL_RETAIL', 7, 'sum(a.localRetailVolume), sum(a.localRetailValue),', 'sum(coalesce(a.localRetailVolume,0)) DESC'),
('brokerActiveVol', 13, 'FOREIGN_RETAIL', 8, 'sum(a.foreignRetailVolume), sum(a.foreignRetailValue),', 'sum(coalesce(a.foreignRetailVolume,0)) DESC'),
('brokerActiveVol', 13, 'NOMINEES', 9, 'sum(a.totalNomineesVolume), sum(a.totalNomineesValue),', 'sum(coalesce(a.totalNomineesVolume,0)) DESC'),
('brokerActiveVol', 13, 'LOCAL_NOMINEES', 10, 'sum(a.localNomineesVolume), sum(a.localNomineesValue),', 'sum(coalesce(a.localNomineesVolume,0)) DESC'),
('brokerActiveVol', 13, 'FOREIGN_NOMINEES', 11, 'sum(a.foreignNomineesVolume), sum(a.foreignNomineesValue),', 'sum(coalesce(a.foreignNomineesVolume,0)) DESC'),
('brokerActiveVol', 13, 'PROPRIETARY', 12, 'sum(coalesce(a.ivtVolume,0) + coalesce(a.pdtVolume,0)), sum(coalesce(a.ivtValue,0) + coalesce(a.pdtValue,0)),', 'sum(coalesce(a.ivtVolume,0) + coalesce(a.pdtVolume,0)) DESC'),
('brokerActiveVol', 13, 'IVT', 13, 'sum(a.ivtVolume), sum(a.ivtValue),', 'sum(coalesce(a.ivtVolume,0)) DESC'),
('brokerActiveVol', 13, 'PDT', 14, 'sum(a.pdtVolume), sum(a.pdtValue),', 'sum(coalesce(a.pdtVolume,0)) DESC'),
('brokerActiveVol', 13, 'INST_NOMINEES', 15, 'sum(coalesce(a.totalInstVolume,0) + coalesce(a.totalNomineesVolume,0)), sum(coalesce(a.totalInstValue,0) + coalesce(a.totalNomineesValue,0)),', 'sum(coalesce(a.totalInstVolume,0) + coalesce(a.totalNomineesVolume,0)) DESC'),
('brokerActiveVol', 13, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.localInstVolume,0) + coalesce(a.localNomineesVolume,0)), sum(coalesce(a.localInstValue,0) + coalesce(a.localNomineesValue,0)),', 'sum(coalesce(a.localInstVolume,0) + coalesce(a.localNomineesVolume,0)) DESC'),
('brokerActiveVol', 13, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.foreignInstVolume,0) + coalesce(a.foreignNomineesVolume,0)), sum(coalesce(a.foreignInstValue,0) + coalesce(a.foreignNomineesValue,0)),', 'sum(coalesce(a.foreignInstVolume,0) + coalesce(a.foreignNomineesVolume,0)) DESC'),
('brokerActiveVol', 13, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.totalRetailVolume,0) + coalesce(a.totalNomineesVolume,0)), sum(coalesce(a.totalRetailValue,0) + coalesce(a.totalNomineesValue,0)),', 'sum(coalesce(a.totalRetailVolume,0) + coalesce(a.totalNomineesVolume,0)) DESC'),
('brokerActiveVol', 13, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.localRetailVolume,0) + coalesce(a.localNomineesVolume,0)), sum(coalesce(a.localRetailValue,0) + coalesce(a.localNomineesValue,0)),', 'sum(coalesce(a.localRetailVolume,0) + coalesce(a.localNomineesVolume,0)) DESC'),
('brokerActiveVol', 13, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.foreignRetailVolume,0) + coalesce(a.foreignNomineesVolume,0)), sum(coalesce(a.foreignRetailValue,0) + coalesce(a.foreignNomineesValue,0)),', 'sum(coalesce(a.foreignRetailVolume,0) + coalesce(a.foreignNomineesVolume,0)) DESC');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES 
('brokerActiveVal', 14, 'ALL', 0, 'sum(a.totalVolume), sum(a.totalValue),', 'sum(coalesce(a.totalValue,0)) DESC'),
('brokerActiveVal', 14, 'LOCAL', 1, 'sum(a.localVolume), sum(a.localValue),', 'sum(coalesce(a.localValue,0)) DESC'),
('brokerActiveVal', 14, 'FOREIGN', 2, 'sum(a.foreignVolume), sum(a.foreignValue),', 'sum(coalesce(a.foreignValue,0)) DESC'),
('brokerActiveVal', 14, 'INST', 3, 'sum(a.totalInstVolume), sum(a.totalInstValue),', 'sum(coalesce(a.totalInstValue,0)) DESC'),
('brokerActiveVal', 14, 'LOCAL_INST', 4, 'sum(a.localInstVolume), sum(a.localInstValue),', 'sum(coalesce(a.localInstValue,0)) DESC'),
('brokerActiveVal', 14, 'FOREIGN_INST', 5, 'sum(a.foreignInstVolume), sum(a.foreignInstValue),', 'sum(coalesce(a.foreignInstValue,0)) DESC'),
('brokerActiveVal', 14, 'RETAIL', 6, 'sum(a.totalRetailVolume), sum(a.totalRetailValue),', 'sum(coalesce(a.totalRetailValue,0)) DESC'),
('brokerActiveVal', 14, 'LOCAL_RETAIL', 7, 'sum(a.localRetailVolume), sum(a.localRetailValue),', 'sum(coalesce(a.localRetailValue,0)) DESC'),
('brokerActiveVal', 14, 'FOREIGN_RETAIL', 8, 'sum(a.foreignRetailVolume), sum(a.foreignRetailValue),', 'sum(coalesce(a.foreignRetailValue,0)) DESC'),
('brokerActiveVal', 14, 'NOMINEES', 9, 'sum(a.totalNomineesVolume), sum(a.totalNomineesValue),', 'sum(coalesce(a.totalNomineesValue,0)) DESC'),
('brokerActiveVal', 14, 'LOCAL_NOMINEES', 10, 'sum(a.localNomineesVolume), sum(a.localNomineesValue),', 'sum(coalesce(a.localNomineesValue,0)) DESC'),
('brokerActiveVal', 14, 'FOREIGN_NOMINEES', 11, 'sum(a.foreignNomineesVolume), sum(a.foreignNomineesValue),', 'sum(coalesce(a.foreignNomineesValue,0)) DESC'),
('brokerActiveVal', 14, 'PROPRIETARY', 12, 'sum(coalesce(a.ivtVolume,0) + coalesce(a.pdtVolume,0)), sum(coalesce(a.ivtValue,0) + coalesce(a.pdtValue,0)),', 'sum(coalesce(a.ivtValue,0) + coalesce(a.pdtValue,0)) DESC'),
('brokerActiveVal', 14, 'IVT', 13, 'sum(a.ivtVolume), sum(a.ivtValue),', 'sum(coalesce(a.ivtValue,0)) DESC'),
('brokerActiveVal', 14, 'PDT', 14, 'sum(a.pdtVolume), sum(a.pdtValue),', 'sum(coalesce(a.pdtValue,0)) DESC'),
('brokerActiveVal', 14, 'INST_NOMINEES', 15, 'sum(coalesce(a.totalInstVolume,0) + coalesce(a.totalNomineesVolume,0)), sum(coalesce(a.totalInstValue,0) + coalesce(a.totalNomineesValue,0)),', 'sum(coalesce(a.totalInstValue,0) + coalesce(a.totalNomineesValue,0)) DESC'),
('brokerActiveVal', 14, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.localInstVolume,0) + coalesce(a.localNomineesVolume,0)), sum(coalesce(a.localInstValue,0) + coalesce(a.localNomineesValue,0)),', 'sum(coalesce(a.localInstValue,0) + coalesce(a.localNomineesValue,0)) DESC'),
('brokerActiveVal', 14, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.foreignInstVolume,0) + coalesce(a.foreignNomineesVolume,0)), sum(coalesce(a.foreignInstValue,0) + coalesce(a.foreignNomineesValue,0)),', 'sum(coalesce(a.foreignInstValue,0) + coalesce(a.foreignNomineesValue,0)) DESC'),
('brokerActiveVal', 14, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.totalRetailVolume,0) + coalesce(a.totalNomineesVolume,0)), sum(coalesce(a.totalRetailValue,0) + coalesce(a.totalNomineesValue,0)),', 'sum(coalesce(a.totalRetailValue,0) + coalesce(a.totalNomineesValue,0)) DESC'),
('brokerActiveVal', 14, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.localRetailVolume,0) + coalesce(a.localNomineesVolume,0)), sum(coalesce(a.localRetailValue,0) + coalesce(a.localNomineesValue,0)),', 'sum(coalesce(a.localRetailValue,0) + coalesce(a.localNomineesValue,0)) DESC'),
('brokerActiveVal', 14, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.foreignRetailVolume,0) + coalesce(a.foreignNomineesVolume,0)), sum(coalesce(a.foreignRetailValue,0) + coalesce(a.foreignNomineesValue,0)),', 'sum(coalesce(a.foreignRetailValue,0) + coalesce(a.foreignNomineesValue,0)) DESC');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES
('brokerNetBuyVal', 15, 'ALL', 0, 'sum(a.netVolume), sum(a.netValue),', 'sum(coalesce(a.netValue,0)) DESC'),
('brokerNetBuyVal', 15, 'LOCAL', 1, 'sum(a.netLocalVolume), sum(a.netLocalValue),', 'sum(coalesce(a.netLocalValue,0)) DESC'),
('brokerNetBuyVal', 15, 'FOREIGN', 2, 'sum(a.netForeignVolume), sum(a.netForeignValue),', 'sum(coalesce(a.netForeignValue,0)) DESC'),
('brokerNetBuyVal', 15, 'INST', 3, 'sum(a.netInstVolume), sum(a.netInstValue),', 'sum(coalesce(a.netInstValue,0)) DESC'),
('brokerNetBuyVal', 15, 'LOCAL_INST', 4, 'sum(a.netLocalInstVol), sum(a.netLocalInstVal),', 'sum(coalesce(a.netLocalInstVal,0)) DESC'),
('brokerNetBuyVal', 15, 'FOREIGN_INST', 5, 'sum(a.netForeignInstVol), sum(a.netForeignInstVal),', 'sum(coalesce(a.netForeignInstVal,0)) DESC'),
('brokerNetBuyVal', 15, 'RETAIL', 6, 'sum(a.netRetailVolume), sum(a.netRetailValue),', 'sum(coalesce(a.netRetailValue,0)) DESC'),
('brokerNetBuyVal', 15, 'LOCAL_RETAIL', 7, 'sum(a.netLocalRetailVol), sum(a.netLocalRetailVal),', 'sum(coalesce(a.netLocalRetailVal,0)) DESC'),
('brokerNetBuyVal', 15, 'FOREIGN_RETAIL', 8, 'sum(a.netForeignRetailVol), sum(a.netForeignRetailVal),', 'sum(coalesce(a.netForeignRetailVal,0)) DESC'),
('brokerNetBuyVal', 15, 'NOMINEES', 9, 'sum(a.netNomineesVolume), sum(a.netNomineesValue),', 'sum(coalesce(a.netNomineesValue,0)) DESC'),
('brokerNetBuyVal', 15, 'LOCAL_NOMINEES', 10, 'sum(a.netLocalNomineesVol), sum(a.netLocalNomineesVal),', 'sum(coalesce(a.netLocalNomineesVal,0)) DESC'),
('brokerNetBuyVal', 15, 'FOREIGN_NOMINEES', 11, 'sum(a.netForeignNomineesVol), sum(a.netForeignNomineesVal),', 'sum(coalesce(a.netForeignNomineesVal,0)) DESC'),
('brokerNetBuyVal', 15, 'PROPRIETARY', 12, 'sum(coalesce(a.netIvtVolume,0) + coalesce(a.netPdtVolume,0)), sum(coalesce(a.netIvtValue,0) + coalesce(a.netPdtValue,0)),', 'sum(coalesce(a.netIvtValue,0) + coalesce(a.netPdtValue,0)) DESC'),
('brokerNetBuyVal', 15, 'IVT', 13, 'sum(a.netIvtVolume), sum(a.netIvtValue),', 'sum(coalesce(a.netIvtValue,0)) DESC'),
('brokerNetBuyVal', 15, 'PDT', 14, 'sum(a.netPdtVolume), sum(a.netPdtValue),', 'sum(coalesce(a.netPdtValue,0)) DESC'),
('brokerNetBuyVal', 15, 'INST_NOMINEES', 15, 'sum(coalesce(a.netInstVolume,0) + coalesce(a.netNomineesVolume,0)), sum(coalesce(a.netInstValue,0) + coalesce(a.netNomineesValue,0)),', 'sum(coalesce(a.netInstValue,0) + coalesce(a.netNomineesValue,0)) DESC'),
('brokerNetBuyVal', 15, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.netLocalInstVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)) DESC'),
('brokerNetBuyVal', 15, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.netForeignInstVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)) DESC'),
('brokerNetBuyVal', 15, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.netRetailVolume,0) + coalesce(a.netNomineesVolume,0)), sum(coalesce(a.netRetailValue,0) + coalesce(a.netNomineesValue,0)),', 'sum(coalesce(a.netRetailValue,0) + coalesce(a.netNomineesValue,0)) DESC'),
('brokerNetBuyVal', 15, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.netLocalRetailVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)) DESC'),
('brokerNetBuyVal', 15, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.netForeignRetailVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)) DESC');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES
('brokerNetBuyValOmtdbt', 16, 'ALL', 0, 'sum(a.netVol), sum(a.netVal),', 'sum(coalesce(a.netVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'LOCAL', 1, 'sum(a.netLocalVol), sum(a.netLocalVal),', 'sum(coalesce(a.netLocalVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'FOREIGN', 2, 'sum(a.netForeignVol), sum(a.netForeignVal),', 'sum(coalesce(a.netForeignVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'INST', 3, 'sum(a.netInstVol), sum(a.netInstVal),', 'sum(coalesce(a.netInstVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'LOCAL_INST', 4, 'sum(a.netLocalInstVol), sum(a.netLocalInstVal),', 'sum(coalesce(a.netLocalInstVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'FOREIGN_INST', 5, 'sum(a.netForeignInstVol), sum(a.netForeignInstVal),', 'sum(coalesce(a.netForeignInstVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'RETAIL', 6, 'sum(a.netRetailVol), sum(a.netRetailVal),', 'sum(coalesce(a.netRetailVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'LOCAL_RETAIL', 7, 'sum(a.netLocalRetailVol), sum(a.netLocalRetailVal),', 'sum(coalesce(a.netLocalRetailVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'FOREIGN_RETAIL', 8, 'sum(a.netForeignRetailVol), sum(a.netForeignRetailVal),', 'sum(coalesce(a.netForeignRetailVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'NOMINEES', 9, 'sum(a.netNomineesVol), sum(a.netNomineesVal),', 'sum(coalesce(a.netNomineesVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'LOCAL_NOMINEES', 10, 'sum(a.netLocalNomineesVol), sum(a.netLocalNomineesVal),', 'sum(coalesce(a.netLocalNomineesVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'FOREIGN_NOMINEES', 11, 'sum(a.netForeignNomineesVol), sum(a.netForeignNomineesVal),', 'sum(coalesce(a.netForeignNomineesVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'PROPRIETARY', 12, 'sum(coalesce(a.netIvtVol,0) + coalesce(a.netPdtVol,0)), sum(coalesce(a.netIvtVal,0) + coalesce(a.netPdtVal,0)),', 'sum(coalesce(a.netIvtVal,0) + coalesce(a.netPdtVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'IVT', 13, 'sum(a.netIvtVol), sum(a.netIvtVal),', 'sum(coalesce(a.netIvtVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'PDT', 14, 'sum(a.netPdtVol), sum(a.netPdtVal),', 'sum(coalesce(a.netPdtVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'INST_NOMINEES', 15, 'sum(coalesce(a.netInstVol,0) + coalesce(a.netNomineesVol,0)), sum(coalesce(a.netInstVal,0) + coalesce(a.netNomineesVal,0)),', 'sum(coalesce(a.netInstVal,0) + coalesce(a.netNomineesVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.netLocalInstVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.netForeignInstVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.netRetailVol,0) + coalesce(a.netNomineesVol,0)), sum(coalesce(a.netRetailVal,0) + coalesce(a.netNomineesVal,0)),', 'sum(coalesce(a.netRetailVal,0) + coalesce(a.netNomineesVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.netLocalRetailVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)) DESC'),
('brokerNetBuyValOmtdbt', 16, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.netForeignRetailVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)) DESC');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES
('brokerNetSellVal', 17, 'ALL', 0, 'sum(a.netVolume), sum(a.netValue),', 'sum(coalesce(a.netValue,0)) ASC'),
('brokerNetSellVal', 17, 'LOCAL', 1, 'sum(a.netLocalVolume), sum(a.netLocalValue),', 'sum(coalesce(a.netLocalValue,0)) ASC'),
('brokerNetSellVal', 17, 'FOREIGN', 2, 'sum(a.netForeignVolume), sum(a.netForeignValue),', 'sum(coalesce(a.netForeignValue,0)) ASC'),
('brokerNetSellVal', 17, 'INST', 3, 'sum(a.netInstVolume), sum(a.netInstValue),', 'sum(coalesce(a.netInstValue,0)) ASC'),
('brokerNetSellVal', 17, 'LOCAL_INST', 4, 'sum(a.netLocalInstVol), sum(a.netLocalInstVal),', 'sum(coalesce(a.netLocalInstVal,0)) ASC'),
('brokerNetSellVal', 17, 'FOREIGN_INST', 5, 'sum(a.netForeignInstVol), sum(a.netForeignInstVal),', 'sum(coalesce(a.netForeignInstVal,0)) ASC'),
('brokerNetSellVal', 17, 'RETAIL', 6, 'sum(a.netRetailVolume), sum(a.netRetailValue),', 'sum(coalesce(a.netRetailValue,0)) ASC'),
('brokerNetSellVal', 17, 'LOCAL_RETAIL', 7, 'sum(a.netLocalRetailVol), sum(a.netLocalRetailVal),', 'sum(coalesce(a.netLocalRetailVal,0)) ASC'),
('brokerNetSellVal', 17, 'FOREIGN_RETAIL', 8, 'sum(a.netForeignRetailVol), sum(a.netForeignRetailVal),', 'sum(coalesce(a.netForeignRetailVal,0)) ASC'),
('brokerNetSellVal', 17, 'NOMINEES', 9, 'sum(a.netNomineesVolume), sum(a.netNomineesValue),', 'sum(coalesce(a.netNomineesValue,0)) ASC'),
('brokerNetSellVal', 17, 'LOCAL_NOMINEES', 10, 'sum(a.netLocalNomineesVol), sum(a.netLocalNomineesVal),', 'sum(coalesce(a.netLocalNomineesVal,0)) ASC'),
('brokerNetSellVal', 17, 'FOREIGN_NOMINEES', 11, 'sum(a.netForeignNomineesVol), sum(a.netForeignNomineesVal),', 'sum(coalesce(a.netForeignNomineesVal,0)) ASC'),
('brokerNetSellVal', 17, 'PROPRIETARY', 12, 'sum(coalesce(a.netIvtVolume,0) + coalesce(a.netPdtVolume,0)), sum(coalesce(a.netIvtValue,0) + coalesce(a.netPdtValue,0)),', 'sum(coalesce(a.netIvtValue,0) + coalesce(a.netPdtValue,0)) ASC'),
('brokerNetSellVal', 17, 'IVT', 13, 'sum(a.netIvtVolume), sum(a.netIvtValue),', 'sum(coalesce(a.netIvtValue,0)) ASC'),
('brokerNetSellVal', 17, 'PDT', 14, 'sum(a.netPdtVolume), sum(a.netPdtValue),', 'sum(coalesce(a.netPdtValue,0)) ASC'),
('brokerNetSellVal', 17, 'INST_NOMINEES', 15, 'sum(coalesce(a.netInstVolume,0) + coalesce(a.netNomineesVolume,0)), sum(coalesce(a.netInstValue,0) + coalesce(a.netNomineesValue,0)),', 'sum(coalesce(a.netInstValue,0) + coalesce(a.netNomineesValue,0)) ASC'),
('brokerNetSellVal', 17, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.netLocalInstVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)) ASC'),
('brokerNetSellVal', 17, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.netForeignInstVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)) ASC'),
('brokerNetSellVal', 17, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.netRetailVolume,0) + coalesce(a.netNomineesVolume,0)), sum(coalesce(a.netRetailValue,0) + coalesce(a.netNomineesValue,0)),', 'sum(coalesce(a.netRetailValue,0) + coalesce(a.netNomineesValue,0)) ASC'),
('brokerNetSellVal', 17, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.netLocalRetailVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)) ASC'),
('brokerNetSellVal', 17, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.netForeignRetailVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)) ASC');

insert into dibots_v2.ref_query_group_type (api, api_num, group_type, group_type_num, vol_val_frag, order_frag)
VALUES
('brokerNetSellValOmtdbt', 18, 'ALL', 0, 'sum(a.netVol), sum(a.netVal),', 'sum(coalesce(a.netVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'LOCAL', 1, 'sum(a.netLocalVol), sum(a.netLocalVal),', 'sum(coalesce(a.netLocalVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'FOREIGN', 2, 'sum(a.netForeignVol), sum(a.netForeignVal),', 'sum(coalesce(a.netForeignVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'INST', 3, 'sum(a.netInstVol), sum(a.netInstVal),', 'sum(coalesce(a.netInstVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'LOCAL_INST', 4, 'sum(a.netLocalInstVol), sum(a.netLocalInstVal),', 'sum(coalesce(a.netLocalInstVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'FOREIGN_INST', 5, 'sum(a.netForeignInstVol), sum(a.netForeignInstVal),', 'sum(coalesce(a.netForeignInstVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'RETAIL', 6, 'sum(a.netRetailVol), sum(a.netRetailVal),', 'sum(coalesce(a.netRetailVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'LOCAL_RETAIL', 7, 'sum(a.netLocalRetailVol), sum(a.netLocalRetailVal),', 'sum(coalesce(a.netLocalRetailVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'FOREIGN_RETAIL', 8, 'sum(a.netForeignRetailVol), sum(a.netForeignRetailVal),', 'sum(coalesce(a.netForeignRetailVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'NOMINEES', 9, 'sum(a.netNomineesVol), sum(a.netNomineesVal),', 'sum(coalesce(a.netNomineesVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'LOCAL_NOMINEES', 10, 'sum(a.netLocalNomineesVol), sum(a.netLocalNomineesVal),', 'sum(coalesce(a.netLocalNomineesVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'FOREIGN_NOMINEES', 11, 'sum(a.netForeignNomineesVol), sum(a.netForeignNomineesVal),', 'sum(coalesce(a.netForeignNomineesVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'PROPRIETARY', 12, 'sum(coalesce(a.netIvtVol,0) + coalesce(a.netPdtVol,0)), sum(coalesce(a.netIvtVal,0) + coalesce(a.netPdtVal,0)),', 'sum(coalesce(a.netIvtVal,0) + coalesce(a.netPdtVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'IVT', 13, 'sum(a.netIvtVol), sum(a.netIvtVal),', 'sum(coalesce(a.netIvtVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'PDT', 14, 'sum(a.netPdtVol), sum(a.netPdtVal),', 'sum(coalesce(a.netPdtVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'INST_NOMINEES', 15, 'sum(coalesce(a.netInstVol,0) + coalesce(a.netNomineesVol,0)), sum(coalesce(a.netInstVal,0) + coalesce(a.netNomineesVal,0)),', 'sum(coalesce(a.netInstVal,0) + coalesce(a.netNomineesVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'LOCAL_INST_NOMINEES', 16, 'sum(coalesce(a.netLocalInstVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalInstVal,0) + coalesce(a.netLocalNomineesVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'FOREIGN_INST_NOMINEES', 17, 'sum(coalesce(a.netForeignInstVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignInstVal,0) + coalesce(a.netForeignNomineesVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'RETAIL_NOMINEES', 18, 'sum(coalesce(a.netRetailVol,0) + coalesce(a.netNomineesVol,0)), sum(coalesce(a.netRetailVal,0) + coalesce(a.netNomineesVal,0)),', 'sum(coalesce(a.netRetailVal,0) + coalesce(a.netNomineesVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'LOCAL_RETAIL_NOMINEES', 19, 'sum(coalesce(a.netLocalRetailVol,0) + coalesce(a.netLocalNomineesVol,0)), sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)),', 'sum(coalesce(a.netLocalRetailVal,0) + coalesce(a.netLocalNomineesVal,0)) ASC'),
('brokerNetSellValOmtdbt', 18, 'FOREIGN_RETAIL_NOMINEES', 20, 'sum(coalesce(a.netForeignRetailVol,0) + coalesce(a.netForeignNomineesVol,0)), sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)),', 'sum(coalesce(a.netForeignRetailVal,0) + coalesce(a.netForeignNomineesVal,0)) ASC');

--=======================

alter table dibots_v2.exchange_daily_transaction add column stock_num int, add column board_num int, add column sector_num int, add column sec_type_num int;

select * from dibots_v2.exchange_daily_transaction

update dibots_v2.exchange_daily_transaction a
set
stock_num = b.id
from dibots_v2.ref_bursa_stock b
where a.stock_code = b.stock_code and a.transaction_date = (select max(transaction_date) from dibots_v2.exchange_daily_transaction) and a.stock_num is null;

update dibots_v2.exchange_daily_transaction a
set
board_num = b.id
from dibots_v2.ref_bursa_board b
where a.board = b.board and a.transaction_date = (select max(transaction_date) from dibots_v2.exchange_daily_transaction) and a.board_num is null;

update dibots_v2.exchange_daily_transaction a
set
sector_num = b.id
from dibots_v2.ref_bursa_sector b
where a.sector = b.sector and a.transaction_date = (select max(transaction_date) from dibots_v2.exchange_daily_transaction) and a.sector_num is null;

update dibots_v2.exchange_daily_transaction a
set
sec_type_num = b.id
from dibots_v2.ref_bursa_sec_type b
where a.security_type = b.security_type and a.transaction_date = (select max(transaction_date) from dibots_v2.exchange_daily_transaction) and a.sec_type_num is null;

vacuum (analyze) dibots_v2.exchange_daily_transaction;
